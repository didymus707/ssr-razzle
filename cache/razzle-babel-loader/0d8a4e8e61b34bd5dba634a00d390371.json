{"ast":null,"code":"import _extends from \"/Users/public1/Documents/Projects/ssr-razzle/node_modules/@babel/runtime/helpers/esm/extends\";\nimport _objectSpread from \"/Users/public1/Documents/Projects/ssr-razzle/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/public1/Documents/Projects/ssr-razzle/src/app/authenticated-app/marketing/campaigns/components/planner/planner.index.tsx\";\nvar __jsx = React.createElement;\nimport { Box, useToast } from '@chakra-ui/core';\nimport { selectSegments } from 'app/authenticated-app/lists';\nimport { isEmpty } from 'lodash';\nimport React from 'react';\nimport { useSelector } from 'react-redux';\nimport { useLoading } from '../../../../../../hooks';\nimport { sendAmplitudeData } from '../../../../../../utils/amplitude';\nimport { ContentWrapper, ToastBox } from '../../../../../components';\nimport { selectOrganisationID } from '../../../../../unauthenticated-app/authentication';\nimport { Design } from './planner.design';\nimport { FlowSteps, SectionContainer, SectionHeader } from './planner.layout';\nimport { Review } from './planner.review';\nimport { Setup } from './planner.setup';\nexport const Planner = props => {\n  let {\n    lists,\n    history,\n    isSaving,\n    audiences,\n    smart_lists,\n    addCampaign,\n    lists_by_id,\n    organisations,\n    fetchTemplates,\n    audiences_by_id,\n    importBulkUpload,\n    saveCampaignDraft,\n    smart_lists_by_id,\n    templateCategories,\n    fetchSampleTemplates,\n    campaign: campaignData,\n    credit_balance,\n    updateCampaign,\n    template,\n    addAudience,\n    editTemplate,\n    user,\n    fetchWallet,\n    fetchStates,\n    fetchGenders,\n    states,\n    genders,\n    religions,\n    ethnicGroups,\n    fetchEthnicGroups,\n    fetchReligions\n  } = props;\n  const toast = useToast();\n  const {\n    dispatch,\n    loading\n  } = useLoading();\n  const [section, setSection] = React.useState(0);\n  const [campaign, setCampaign] = React.useState(campaignData);\n  const segments = useSelector(selectSegments);\n  const organizationID = useSelector(selectOrganisationID);\n  const currentOrganization = organisations === null || organisations === void 0 ? void 0 : organisations.find(i => i.id === organizationID);\n  const organisationName = currentOrganization === null || currentOrganization === void 0 ? void 0 : currentOrganization['name'];\n  const mappedTemplateCategories = templateCategories.map(item => item.category);\n  const sectionsHeaderProps = {\n    0: {\n      heading: 'Set up your campaign',\n      subheading: 'Give your campaign a name and choose who to send to.'\n    },\n    1: {\n      heading: 'Design your campaign',\n      subheading: 'Compose your message below.'\n    },\n    2: {\n      heading: 'Review your campaign before sending',\n      subheading: 'Please review your campaign details before sending.'\n    }\n  };\n  const listOptions = lists_by_id //@ts-ignore\n  .map(id => lists[id]).map(({\n    name,\n    id\n  }) => ({\n    label: name,\n    value: id\n  }));\n  const smartListOptions = smart_lists_by_id //@ts-ignore\n  .map(id => smart_lists[id]).map(({\n    name,\n    id\n  }) => ({\n    label: name,\n    value: `${id}-smartList`\n  }));\n  const audienceOptions = audiences_by_id //@ts-ignore\n  .map(id => audiences[id]).map(({\n    name,\n    id\n  }) => ({\n    label: name,\n    value: `${id}-audience`\n  })); // const importOptions = [{ label: 'Import a CSV/Excel file', value: 'import' }];\n\n  const segmentOptions = segments.map(({\n    name,\n    id\n  }) => ({\n    label: name,\n    value: `${id}-segment`\n  }));\n  const newAudienceOptions = [{\n    label: 'Create a new audience',\n    value: 'new-audience'\n  }];\n  const allLists = (user === null || user === void 0 ? void 0 : user.account_type) === 9 ? [{\n    label: 'New Audience',\n    options: newAudienceOptions,\n    showBadge: false\n  }, // { label: 'Import', options: importOptions, showBadge: false },\n  {\n    label: 'Lists',\n    options: listOptions,\n    showBadge: true\n  }, {\n    label: 'Smart lists',\n    options: smartListOptions,\n    showBadge: true\n  }, {\n    label: 'Segments',\n    options: segmentOptions,\n    showBadge: true\n  }, {\n    label: 'Audiences',\n    options: audienceOptions,\n    showBadge: true\n  }] : [// { label: 'Import', options: importOptions, showBadge: false },\n  {\n    label: 'Lists',\n    options: listOptions,\n    showBadge: true\n  }, {\n    label: 'Smart lists',\n    options: smartListOptions,\n    showBadge: true\n  }, {\n    label: 'Segments',\n    options: segmentOptions,\n    showBadge: true\n  }];\n  const allStates = states.map(state => ({\n    value: state,\n    label: state\n  }));\n  const allGenders = genders.map(state => ({\n    value: state,\n    label: state\n  }));\n  const allReligions = religions.map(religion => ({\n    value: religion,\n    label: religion\n  }));\n  const allEthnicGroups = ethnicGroups.map(ethnicGroup => ({\n    value: ethnicGroup,\n    label: ethnicGroup\n  }));\n\n  const handleCancel = () => history.goBack();\n\n  const handleGoBack = () => {\n    setSection(section - 1);\n  };\n\n  const handleGoToSection = section => {\n    setSection(section);\n  };\n\n  const handleSubmit = data => {\n    setCampaign(_objectSpread(_objectSpread({}, campaign), data));\n    setSection(section + 1);\n  };\n\n  const handleEditCampaign = async payload => {\n    try {\n      dispatch({\n        type: 'LOADING_STARTED'\n      });\n      await updateCampaign(payload);\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          status: \"success\",\n          onClose: onClose,\n          message: \"Campaign updated successfully\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 11\n          }\n        })\n      });\n      sendAmplitudeData('campaignUpdated', {\n        data: payload\n      });\n      history.push('/s/marketing/campaigns');\n    } catch (error) {\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 34\n          }\n        })\n      });\n    }\n  };\n\n  const handleSaveDraft = async payload => {\n    try {\n      dispatch({\n        type: 'LOADING_STARTED'\n      });\n      await saveCampaignDraft(payload);\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          status: \"success\",\n          onClose: onClose,\n          message: \"Campaign saved as draft\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 179,\n            columnNumber: 11\n          }\n        })\n      });\n      sendAmplitudeData('campaignSavedAsDraft', {\n        data: payload\n      });\n      history.push('/s/marketing/campaigns');\n    } catch (error) {\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 34\n          }\n        })\n      });\n    }\n  };\n\n  const handleUpdateTemplate = async payload => {\n    try {\n      await editTemplate(payload);\n    } catch (error) {\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 199,\n            columnNumber: 34\n          }\n        })\n      });\n    }\n  };\n\n  const handleSaveAsDraft = async payload => {\n    if (campaign.state && campaign.state === 'draft') {\n      await handleEditCampaign(payload);\n    } else {\n      await handleSaveDraft(payload);\n    }\n  };\n\n  React.useEffect(() => {\n    if (!isEmpty(campaignData) && campaignData.template_id) {\n      setCampaign(_objectSpread(_objectSpread({}, campaignData), {}, {\n        content: template.template\n      }));\n    }\n  }, [campaignData, template]);\n  React.useEffect(() => {\n    const getAllStates = async () => {\n      try {\n        await fetchStates();\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    const getGenders = async () => {\n      try {\n        await fetchGenders();\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    const getReligions = async () => {\n      try {\n        await fetchReligions();\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    const getEthnicities = async () => {\n      try {\n        await fetchEthnicGroups();\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    getAllStates();\n    getGenders();\n    getReligions();\n    getEthnicities();\n  }, [fetchStates, fetchGenders, fetchEthnicGroups, fetchReligions]);\n  return __jsx(ContentWrapper, {\n    p: \"1.875rem\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 5\n    }\n  }, __jsx(SectionContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }\n  }, __jsx(Box, {\n    pb: \"2rem\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 9\n    }\n  }, __jsx(SectionHeader, _extends({\n    pb: \"1rem\"\n  }, sectionsHeaderProps[section], {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 11\n    }\n  })), __jsx(FlowSteps, {\n    activeSection: section,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 11\n    }\n  })), section === 0 && __jsx(Setup, {\n    lists: allLists,\n    states: allStates,\n    genders: allGenders,\n    onGoBack: handleCancel,\n    onSubmit: handleSubmit,\n    initialValues: campaign,\n    religions: allReligions,\n    addAudience: addAudience,\n    ethnicGroups: allEthnicGroups,\n    organisationName: organisationName,\n    importBulkUpload: importBulkUpload,\n    hasAudiences: !!audiences_by_id.length,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 11\n    }\n  }), section === 1 && __jsx(Design, {\n    onGoBack: handleGoBack,\n    onSubmit: handleSubmit,\n    initialValues: campaign,\n    fetchWallet: fetchWallet,\n    fetchTemplates: fetchTemplates,\n    credit_balance: credit_balance,\n    fetchSampleTemplates: fetchSampleTemplates,\n    handleUpdateTemplate: handleUpdateTemplate,\n    templateCategories: mappedTemplateCategories,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 11\n    }\n  }), section === 2 && __jsx(Review, {\n    campaign: campaign,\n    isSaving: isSaving,\n    onSubmit: addCampaign,\n    onGoBack: handleGoBack,\n    credit_balance: credit_balance,\n    onSaveDraft: handleSaveAsDraft,\n    onGoToSection: handleGoToSection,\n    isSavingDraft: loading === 'pending',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 11\n    }\n  })));\n};","map":{"version":3,"sources":["/Users/public1/Documents/Projects/ssr-razzle/src/app/authenticated-app/marketing/campaigns/components/planner/planner.index.tsx"],"names":["Box","useToast","selectSegments","isEmpty","React","useSelector","useLoading","sendAmplitudeData","ContentWrapper","ToastBox","selectOrganisationID","Design","FlowSteps","SectionContainer","SectionHeader","Review","Setup","Planner","props","lists","history","isSaving","audiences","smart_lists","addCampaign","lists_by_id","organisations","fetchTemplates","audiences_by_id","importBulkUpload","saveCampaignDraft","smart_lists_by_id","templateCategories","fetchSampleTemplates","campaign","campaignData","credit_balance","updateCampaign","template","addAudience","editTemplate","user","fetchWallet","fetchStates","fetchGenders","states","genders","religions","ethnicGroups","fetchEthnicGroups","fetchReligions","toast","dispatch","loading","section","setSection","useState","setCampaign","segments","organizationID","currentOrganization","find","i","id","organisationName","mappedTemplateCategories","map","item","category","sectionsHeaderProps","heading","subheading","listOptions","name","label","value","smartListOptions","audienceOptions","segmentOptions","newAudienceOptions","allLists","account_type","options","showBadge","allStates","state","allGenders","allReligions","religion","allEthnicGroups","ethnicGroup","handleCancel","goBack","handleGoBack","handleGoToSection","handleSubmit","data","handleEditCampaign","payload","type","position","render","onClose","push","error","handleSaveDraft","handleUpdateTemplate","handleSaveAsDraft","useEffect","template_id","content","getAllStates","console","log","getGenders","getReligions","getEthnicities","length"],"mappings":"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","sourcesContent":["import { Box, useToast } from '@chakra-ui/core';\nimport { selectSegments } from 'app/authenticated-app/lists';\nimport { isEmpty } from 'lodash';\nimport React from 'react';\nimport { useSelector } from 'react-redux';\nimport { useLoading } from '../../../../../../hooks';\nimport { sendAmplitudeData } from '../../../../../../utils/amplitude';\nimport { ContentWrapper, ToastBox } from '../../../../../components';\nimport { selectOrganisationID } from '../../../../../unauthenticated-app/authentication';\nimport { TemplateData } from '../../../templates';\nimport { CampaignData } from '../../campaigns.types';\nimport { PlannerProps } from '../../planner.types';\nimport { Design } from './planner.design';\nimport { FlowSteps, SectionContainer, SectionHeader, SectionHeaderProps } from './planner.layout';\nimport { Review } from './planner.review';\nimport { Setup } from './planner.setup';\n\nexport type CampaignPayload = Partial<CampaignData> & {\n  smart_sending?: string;\n  template_type?: string;\n  variants_count?: string;\n  smartSending?: string;\n  templateType?: string;\n  campaign_id?: string | null;\n};\n\nexport const Planner = (props: PlannerProps & { isSaving?: boolean }) => {\n  let {\n    lists,\n    history,\n    isSaving,\n    audiences,\n    smart_lists,\n    addCampaign,\n    lists_by_id,\n    organisations,\n    fetchTemplates,\n    audiences_by_id,\n    importBulkUpload,\n    saveCampaignDraft,\n    smart_lists_by_id,\n    templateCategories,\n    fetchSampleTemplates,\n    campaign: campaignData,\n    credit_balance,\n    updateCampaign,\n    template,\n    addAudience,\n    editTemplate,\n    user,\n    fetchWallet,\n    fetchStates,\n    fetchGenders,\n    states,\n    genders,\n    religions,\n    ethnicGroups,\n    fetchEthnicGroups,\n    fetchReligions,\n  } = props;\n\n  const toast = useToast();\n  const { dispatch, loading } = useLoading();\n\n  const [section, setSection] = React.useState(0);\n  const [campaign, setCampaign] = React.useState(campaignData);\n\n  const segments = useSelector(selectSegments);\n  const organizationID = useSelector(selectOrganisationID);\n  const currentOrganization = organisations?.find((i: any) => i.id === organizationID);\n\n  const organisationName = currentOrganization?.['name'];\n  const mappedTemplateCategories = templateCategories.map(item => item.category);\n  const sectionsHeaderProps = {\n    0: {\n      heading: 'Set up your campaign',\n      subheading: 'Give your campaign a name and choose who to send to.',\n    },\n    1: {\n      heading: 'Design your campaign',\n      subheading: 'Compose your message below.',\n    },\n    2: {\n      heading: 'Review your campaign before sending',\n      subheading: 'Please review your campaign details before sending.',\n    },\n  } as { [key: number]: SectionHeaderProps };\n\n  const listOptions = lists_by_id\n    //@ts-ignore\n    .map((id: string) => lists[id])\n    .map(({ name, id }) => ({ label: name, value: id }));\n\n  const smartListOptions = smart_lists_by_id\n    //@ts-ignore\n    .map((id: string) => smart_lists[id])\n    .map(({ name, id }) => ({ label: name, value: `${id}-smartList` }));\n\n  const audienceOptions = audiences_by_id\n    //@ts-ignore\n    .map((id: string) => audiences[id])\n    .map(({ name, id }) => ({ label: name, value: `${id}-audience` }));\n\n  // const importOptions = [{ label: 'Import a CSV/Excel file', value: 'import' }];\n  const segmentOptions = segments.map(({ name, id }) => ({ label: name, value: `${id}-segment` }));\n\n  const newAudienceOptions = [{ label: 'Create a new audience', value: 'new-audience' }];\n\n  const allLists =\n    user?.account_type === 9\n      ? [\n          { label: 'New Audience', options: newAudienceOptions, showBadge: false },\n          // { label: 'Import', options: importOptions, showBadge: false },\n          { label: 'Lists', options: listOptions, showBadge: true },\n          { label: 'Smart lists', options: smartListOptions, showBadge: true },\n          { label: 'Segments', options: segmentOptions, showBadge: true },\n          { label: 'Audiences', options: audienceOptions, showBadge: true },\n        ]\n      : [\n          // { label: 'Import', options: importOptions, showBadge: false },\n          { label: 'Lists', options: listOptions, showBadge: true },\n          { label: 'Smart lists', options: smartListOptions, showBadge: true },\n          { label: 'Segments', options: segmentOptions, showBadge: true },\n        ];\n\n  const allStates = states.map(state => ({ value: state, label: state }));\n  const allGenders = genders.map(state => ({ value: state, label: state }));\n  const allReligions = religions.map(religion => ({ value: religion, label: religion }));\n  const allEthnicGroups = ethnicGroups.map(ethnicGroup => ({\n    value: ethnicGroup,\n    label: ethnicGroup,\n  }));\n\n  const handleCancel = () => history.goBack();\n\n  const handleGoBack = () => {\n    setSection(section - 1);\n  };\n\n  const handleGoToSection = (section: number) => {\n    setSection(section);\n  };\n\n  const handleSubmit = (data: CampaignPayload) => {\n    setCampaign({ ...campaign, ...data });\n    setSection(section + 1);\n  };\n\n  const handleEditCampaign = async (payload: Partial<CampaignPayload>) => {\n    try {\n      dispatch({ type: 'LOADING_STARTED' });\n      await updateCampaign(payload);\n      dispatch({ type: 'LOADING_RESOLVED' });\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => (\n          <ToastBox status=\"success\" onClose={onClose} message=\"Campaign updated successfully\" />\n        ),\n      });\n      sendAmplitudeData('campaignUpdated', { data: payload });\n      history.push('/s/marketing/campaigns');\n    } catch (error) {\n      dispatch({ type: 'LOADING_RESOLVED' });\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n      });\n    }\n  };\n\n  const handleSaveDraft = async (payload: CampaignPayload) => {\n    try {\n      dispatch({ type: 'LOADING_STARTED' });\n      await saveCampaignDraft(payload);\n      dispatch({ type: 'LOADING_RESOLVED' });\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => (\n          <ToastBox status=\"success\" onClose={onClose} message=\"Campaign saved as draft\" />\n        ),\n      });\n      sendAmplitudeData('campaignSavedAsDraft', { data: payload });\n      history.push('/s/marketing/campaigns');\n    } catch (error) {\n      dispatch({ type: 'LOADING_RESOLVED' });\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n      });\n    }\n  };\n\n  const handleUpdateTemplate = async (payload: TemplateData) => {\n    try {\n      await editTemplate(payload);\n    } catch (error) {\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n      });\n    }\n  };\n\n  const handleSaveAsDraft = async (payload: Partial<CampaignPayload>) => {\n    if (campaign.state && campaign.state === 'draft') {\n      await handleEditCampaign(payload);\n    } else {\n      await handleSaveDraft(payload);\n    }\n  };\n\n  React.useEffect(() => {\n    if (!isEmpty(campaignData) && campaignData.template_id) {\n      setCampaign({ ...campaignData, content: template.template });\n    }\n  }, [campaignData, template]);\n\n  React.useEffect(() => {\n    const getAllStates = async () => {\n      try {\n        await fetchStates();\n      } catch (error) {\n        console.log(error);\n      }\n    };\n    const getGenders = async () => {\n      try {\n        await fetchGenders();\n      } catch (error) {\n        console.log(error);\n      }\n    };\n    const getReligions = async () => {\n      try {\n        await fetchReligions();\n      } catch (error) {\n        console.log(error);\n      }\n    };\n    const getEthnicities = async () => {\n      try {\n        await fetchEthnicGroups();\n      } catch (error) {\n        console.log(error);\n      }\n    };\n\n    getAllStates();\n    getGenders();\n    getReligions();\n    getEthnicities();\n  }, [fetchStates, fetchGenders, fetchEthnicGroups, fetchReligions]);\n\n  return (\n    <ContentWrapper p=\"1.875rem\">\n      <SectionContainer>\n        <Box pb=\"2rem\">\n          <SectionHeader pb=\"1rem\" {...sectionsHeaderProps[section]} />\n          <FlowSteps activeSection={section} />\n        </Box>\n        {section === 0 && (\n          <Setup\n            lists={allLists}\n            states={allStates}\n            genders={allGenders}\n            onGoBack={handleCancel}\n            onSubmit={handleSubmit}\n            initialValues={campaign}\n            religions={allReligions}\n            addAudience={addAudience}\n            ethnicGroups={allEthnicGroups}\n            organisationName={organisationName}\n            importBulkUpload={importBulkUpload}\n            hasAudiences={!!audiences_by_id.length}\n          />\n        )}\n        {section === 1 && (\n          <Design\n            onGoBack={handleGoBack}\n            onSubmit={handleSubmit}\n            initialValues={campaign}\n            fetchWallet={fetchWallet}\n            fetchTemplates={fetchTemplates}\n            credit_balance={credit_balance}\n            fetchSampleTemplates={fetchSampleTemplates}\n            handleUpdateTemplate={handleUpdateTemplate}\n            templateCategories={mappedTemplateCategories}\n          />\n        )}\n        {section === 2 && (\n          <Review\n            campaign={campaign}\n            isSaving={isSaving}\n            onSubmit={addCampaign}\n            onGoBack={handleGoBack}\n            credit_balance={credit_balance}\n            onSaveDraft={handleSaveAsDraft}\n            onGoToSection={handleGoToSection}\n            isSavingDraft={loading === 'pending'}\n          />\n        )}\n      </SectionContainer>\n    </ContentWrapper>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}