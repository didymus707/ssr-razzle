{"ast":null,"code":"import _objectSpread from \"/Users/okechukwuiheagwara/Documents/Adewale/simpu/razzle/with-typescript/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/okechukwuiheagwara/Documents/Adewale/simpu/razzle/with-typescript/src/app/authenticated-app/marketing/campaigns/campaigns.component.tsx\";\nvar __jsx = React.createElement;\nimport { Box, Flex, Heading, Text, useDisclosure, useToast } from '@chakra-ui/core';\nimport { Button } from 'app/components';\nimport React, { useState } from 'react';\nimport { useMutation, useQuery, useQueryClient } from 'react-query';\nimport { sendAmplitudeData } from '../../../../utils/amplitude';\nimport { ConfirmModal, ToastBox } from '../../../components';\nimport { CAMPAIGN_LIST_LIMIT, deleteCampaignItem, filterCampaigns, saveCampaignItemState, searchCampaigns } from './campaigns.service';\nimport { CampaignContent, CampaignMetaModal, CampaingPreviewModal } from './components';\nexport function CampaignsComponent(props) {\n  var _data$meta;\n\n  const {\n    history\n  } = props;\n  const toast = useToast();\n  const queryClient = useQueryClient();\n  const {\n    isOpen: isCreateCampaignModalOpen,\n    onClose: onCloseCreateCampaignModal,\n    onOpen: onOpenCreateCampaignModal\n  } = useDisclosure();\n  const {\n    0: page,\n    1: setPage\n  } = useState(1);\n  const {\n    0: start,\n    1: setStart\n  } = useState(1);\n  const {\n    0: searchQuery,\n    1: setSearchQuery\n  } = useState('');\n  const {\n    0: end,\n    1: setEnd\n  } = useState(CAMPAIGN_LIST_LIMIT);\n  const {\n    0: activeTab,\n    1: setActiveTab\n  } = useState();\n  const {\n    0: campaignToDelete,\n    1: setCampaignToDelete\n  } = useState();\n  const {\n    0: campaignToPreview,\n    1: setCampaignToPreview\n  } = useState();\n\n  async function handleFilterCampaigns({\n    page,\n    query\n  }) {\n    try {\n      const {\n        data\n      } = await filterCampaigns({\n        page,\n        query\n      });\n      return data;\n    } catch (error) {}\n  }\n\n  function handleSearchCampaigns(query) {\n    setSearchQuery(query);\n  }\n\n  function handleCampaignStateChange(campaign, state) {\n    mutateCampaignState({\n      campaign,\n      state\n    });\n  }\n\n  function handleCampaignDelete() {\n    if (campaignToDelete) {\n      mutateDeleteCampaign(campaignToDelete);\n    }\n  }\n\n  function handlePagination(pageNumber) {\n    if (pageNumber > page) {\n      setStart(start + CAMPAIGN_LIST_LIMIT);\n      setEnd(end + CAMPAIGN_LIST_LIMIT);\n    } else {\n      setStart(start - CAMPAIGN_LIST_LIMIT);\n      setEnd(end - CAMPAIGN_LIST_LIMIT);\n    }\n\n    setPage(pageNumber);\n  }\n\n  function handleTabChange(tab) {\n    setActiveTab(tab);\n    setPage(1);\n    setStart(1);\n    setEnd(CAMPAIGN_LIST_LIMIT);\n  }\n\n  function handleEditCampaign(campaign) {\n    history.push(`/s/marketing/campaigns/${campaign.id}`);\n  }\n\n  function handleCreateOneTimeCampaign() {\n    history.push('/s/marketing/campaigns/new/one-time-campaign');\n  }\n\n  function handleABTestCampaign() {\n    history.push('/s/marketing/campaigns/new/ab-test-campaign');\n  }\n\n  function handleViewCampaignStats(campaign) {\n    sendAmplitudeData('viewCampaignStats');\n    history.push(`/s/marketing/campaigns/${campaign.id}/analytics`);\n  }\n\n  function getTableActions(data) {\n    const tableActionsStart = [{\n      icon: 'play',\n      label: 'Start campaign',\n      onClick: data => handleCampaignStateChange(data, 'started')\n    }, {\n      icon: 'info',\n      label: 'Preview campaign',\n      onClick: data => setCampaignToPreview(data)\n    }, {\n      icon: 'edit',\n      label: 'Edit campaign',\n      onClick: data => handleEditCampaign(data)\n    }, {\n      icon: 'delete',\n      label: 'Delete campaign',\n      onClick: data => setCampaignToDelete(data)\n    }];\n    const tableActionsPause = [{\n      icon: 'pause',\n      label: 'Pause campaign',\n      onClick: data => {\n        const state = data.state === 'started' ? 'paused' : 'started';\n        handleCampaignStateChange(data, state);\n      }\n    }, {\n      icon: 'stop',\n      label: 'Stop campaign',\n      onClick: data => handleCampaignStateChange(data, 'stopped')\n    }, {\n      icon: 'info',\n      label: 'Preview campaign',\n      onClick: data => {\n        sendAmplitudeData('previewCampaign', {\n          data\n        });\n        setCampaignToPreview(data);\n      }\n    }, {\n      icon: 'view',\n      label: 'View stats',\n      onClick: data => handleViewCampaignStats(data)\n    }, {\n      icon: 'edit',\n      label: 'Edit campaign',\n      onClick: data => handleEditCampaign(data)\n    }, {\n      icon: 'delete',\n      label: 'Delete campaign',\n      onClick: data => setCampaignToDelete(data)\n    }];\n\n    if (data.state === 'pristine') {\n      return tableActionsStart;\n    }\n\n    if (data.state === 'paused') {\n      return [{\n        icon: 'play',\n        label: 'Start campaign',\n        onClick: data => handleCampaignStateChange(data, 'started')\n      }, {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'view',\n        label: 'View stats',\n        onClick: data => handleViewCampaignStats(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    if (data.state === 'stopped') {\n      return [{\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'view',\n        label: 'View stats',\n        onClick: data => handleViewCampaignStats(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    if (data.state === 'draft') {\n      return [{\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'edit',\n        label: 'Edit campaign',\n        onClick: data => handleEditCampaign(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    if (data.state === 'started' && !!data.schedule_start) {\n      return [{\n        icon: 'pause',\n        label: 'Pause campaign',\n        onClick: data => {\n          const state = data.state === 'started' ? 'paused' : 'started';\n          handleCampaignStateChange(data, state);\n        }\n      }, {\n        icon: 'stop',\n        label: 'Stop campaign',\n        onClick: data => handleCampaignStateChange(data, 'stopped')\n      }, {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'view',\n        label: 'View stats',\n        onClick: data => handleViewCampaignStats(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    if (data.state === 'completed' || data.state && data.schedule_start === null) {\n      return [{\n        icon: 'view',\n        label: 'View stats',\n        onClick: data => handleViewCampaignStats(data)\n      }, {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    return tableActionsPause;\n  }\n\n  const {\n    data,\n    isLoading: isFetchingCampaigns\n  } = useQuery(['campaigns', page, activeTab], () => handleFilterCampaigns({\n    page,\n    query: activeTab\n  }), {\n    keepPreviousData: true\n  });\n  const {\n    data: searchResults,\n    isLoading: isSearchingCampaigns\n  } = useQuery(['campaigns', searchQuery], () => searchCampaigns({\n    query: searchQuery || undefined,\n    state: activeTab\n  }), {\n    enabled: !!searchQuery\n  });\n  const {\n    mutate: mutateCampaignState\n  } = useMutation(payload => saveCampaignItemState({\n    id: payload.campaign.id,\n    state: payload.state\n  }), {\n    onMutate: async payload => {\n      const {\n        campaign,\n        state\n      } = payload;\n      const {\n        id\n      } = campaign;\n\n      const newData = _objectSpread(_objectSpread({}, campaign), {}, {\n        state\n      });\n\n      await queryClient.cancelQueries(['campaigns', page, activeTab]);\n      const previousCampaigns = queryClient.getQueryData(['campaigns', page, activeTab]);\n      queryClient.setQueryData(['campaigns', page, activeTab], old => _objectSpread(_objectSpread({}, old), {}, {\n        //@ts-ignore\n        campaigns: old === null || old === void 0 ? void 0 : old.campaigns.map(campaign => {\n          if (campaign.id === id) {\n            return newData;\n          }\n\n          return campaign;\n        })\n      }));\n      return {\n        previousCampaigns\n      };\n    },\n    onSuccess: newData => {\n      queryClient.invalidateQueries(['campaigns', page, activeTab]);\n      sendAmplitudeData('campaignStateChanged', {\n        state: newData.state\n      });\n    },\n    onError: (error, _, context) => {\n      queryClient.setQueryData(['campaigns', page, activeTab], context.previousCampaigns);\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error.message,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 324,\n            columnNumber: 36\n          }\n        })\n      });\n    }\n  });\n  const {\n    isLoading: isDeleting,\n    mutate: mutateDeleteCampaign\n  } = useMutation(campaign => deleteCampaignItem({\n    id: campaign.id\n  }), {\n    onMutate: async payload => {\n      const {\n        id\n      } = payload;\n      await queryClient.cancelQueries(['campaigns', page, activeTab]);\n      const previousCampaigns = queryClient.getQueryData(['campaigns', page, activeTab]);\n      queryClient.setQueryData(['campaigns', page, activeTab], old => _objectSpread(_objectSpread({}, old), {}, {\n        //@ts-ignore\n        campaigns: old === null || old === void 0 ? void 0 : old.campaigns.filter(campaign => campaign.id !== id)\n      }));\n      return {\n        previousCampaigns\n      };\n    },\n    onSuccess: newData => {\n      queryClient.invalidateQueries(['campaigns', page, activeTab]);\n      setCampaignToDelete(undefined);\n      sendAmplitudeData('campaignDeleted');\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          status: \"success\",\n          onClose: onClose,\n          message: \"Campaign deleted successfully\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 11\n          }\n        })\n      });\n    },\n    onError: (error, _, context) => {\n      queryClient.setQueryData(['campaigns', page, activeTab], context.previousCampaigns);\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error.message,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 34\n          }\n        })\n      });\n    }\n  });\n  return __jsx(React.Fragment, null, __jsx(Flex, {\n    pb: \"2.5rem\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 7\n    }\n  }, __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 9\n    }\n  }, __jsx(Heading, {\n    as: \"h4\",\n    pb: \"0.2rem\",\n    fontSize: \"1.2rem\",\n    fontWeight: 600,\n    color: \"black\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 11\n    }\n  }, \"Campaigns\"), __jsx(Text, {\n    maxW: \"500px\",\n    color: \"#4f4f4f\",\n    fontSize: \"0.875rem\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 11\n    }\n  }, \"Easily design and send targeted messages to reach your customers throughout their lifecycle.\")), __jsx(Button, {\n    size: \"sm\",\n    variantColor: \"blue\",\n    onClick: onOpenCreateCampaignModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 9\n    }\n  }, \"Create campaign\")), __jsx(CampaignContent, {\n    end: end,\n    page: page,\n    start: start,\n    selectedTab: activeTab,\n    onTabChange: handleTabChange,\n    onPagination: handlePagination,\n    onSearch: handleSearchCampaigns,\n    getTableActions: getTableActions,\n    total_count: data === null || data === void 0 ? void 0 : (_data$meta = data.meta) === null || _data$meta === void 0 ? void 0 : _data$meta.count_total,\n    stateOptions: [{\n      label: 'All',\n      value: undefined\n    }, {\n      label: 'Scheduled',\n      value: 'scheduled'\n    }, {\n      label: 'Sent',\n      value: 'sent'\n    }, {\n      label: 'Draft',\n      value: 'draft'\n    }],\n    campaignsList: searchResults !== null && searchResults !== void 0 ? searchResults : data === null || data === void 0 ? void 0 : data.campaigns,\n    isLoading: isFetchingCampaigns || isSearchingCampaigns,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 7\n    }\n  }), __jsx(ConfirmModal, {\n    title: \"Delete campaign\",\n    isLoading: isDeleting,\n    isOpen: !!campaignToDelete,\n    onConfirm: handleCampaignDelete,\n    onClose: () => setCampaignToDelete(undefined),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 7\n    }\n  }), __jsx(CampaingPreviewModal, {\n    campaign: campaignToPreview,\n    isOpen: !!campaignToPreview,\n    onClose: () => setCampaignToPreview(undefined),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 7\n    }\n  }), __jsx(CampaignMetaModal, {\n    title: \"Create a campaign\",\n    isOpen: isCreateCampaignModalOpen,\n    onClose: onCloseCreateCampaignModal,\n    options: [{\n      icon: 'single-campaign',\n      title: 'One-time message',\n      caption: 'Keep subscribers engaged and drive revenue by sharing your latest news or promoting a product or sale.',\n      onSelect: handleCreateOneTimeCampaign,\n      showButton: false\n    }, {\n      icon: 'multi-campaign',\n      title: 'A/B test',\n      caption: 'Send up to four variants of a single message, testing text or images to determine which perform best.',\n      onSelect: handleABTestCampaign,\n      showButton: false\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 7\n    }\n  }));\n}","map":{"version":3,"sources":["/Users/okechukwuiheagwara/Documents/Adewale/simpu/razzle/with-typescript/src/app/authenticated-app/marketing/campaigns/campaigns.component.tsx"],"names":["Box","Flex","Heading","Text","useDisclosure","useToast","Button","React","useState","useMutation","useQuery","useQueryClient","sendAmplitudeData","ConfirmModal","ToastBox","CAMPAIGN_LIST_LIMIT","deleteCampaignItem","filterCampaigns","saveCampaignItemState","searchCampaigns","CampaignContent","CampaignMetaModal","CampaingPreviewModal","CampaignsComponent","props","history","toast","queryClient","isOpen","isCreateCampaignModalOpen","onClose","onCloseCreateCampaignModal","onOpen","onOpenCreateCampaignModal","page","setPage","start","setStart","searchQuery","setSearchQuery","end","setEnd","activeTab","setActiveTab","campaignToDelete","setCampaignToDelete","campaignToPreview","setCampaignToPreview","handleFilterCampaigns","query","data","error","handleSearchCampaigns","handleCampaignStateChange","campaign","state","mutateCampaignState","handleCampaignDelete","mutateDeleteCampaign","handlePagination","pageNumber","handleTabChange","tab","handleEditCampaign","push","id","handleCreateOneTimeCampaign","handleABTestCampaign","handleViewCampaignStats","getTableActions","tableActionsStart","icon","label","onClick","tableActionsPause","schedule_start","isLoading","isFetchingCampaigns","keepPreviousData","searchResults","isSearchingCampaigns","undefined","enabled","mutate","payload","onMutate","newData","cancelQueries","previousCampaigns","getQueryData","setQueryData","old","campaigns","map","onSuccess","invalidateQueries","onError","_","context","position","render","message","isDeleting","filter","meta","count_total","value","title","caption","onSelect","showButton"],"mappings":"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","sourcesContent":["import { Box, Flex, Heading, Text, useDisclosure, useToast } from '@chakra-ui/core';\nimport { Button } from 'app/components';\nimport { AxiosError } from 'axios';\nimport React, { useState } from 'react';\nimport { useMutation, useQuery, useQueryClient } from 'react-query';\nimport { sendAmplitudeData } from '../../../../utils/amplitude';\nimport { ConfirmModal, TableDropdownAction, ToastBox } from '../../../components';\nimport {\n  CAMPAIGN_LIST_LIMIT,\n  deleteCampaignItem,\n  filterCampaigns,\n  saveCampaignItemState,\n  searchCampaigns,\n} from './campaigns.service';\nimport { CampaignComponentProps, CampaignData, CampaignTypes } from './campaigns.types';\nimport { CampaignContent, CampaignMetaModal, CampaingPreviewModal } from './components';\n\nexport function CampaignsComponent(props: CampaignComponentProps) {\n  const { history } = props;\n  const toast = useToast();\n  const queryClient = useQueryClient();\n\n  const {\n    isOpen: isCreateCampaignModalOpen,\n    onClose: onCloseCreateCampaignModal,\n    onOpen: onOpenCreateCampaignModal,\n  } = useDisclosure();\n\n  const [page, setPage] = useState(1);\n  const [start, setStart] = useState(1);\n  const [searchQuery, setSearchQuery] = useState('');\n  const [end, setEnd] = useState(CAMPAIGN_LIST_LIMIT);\n  const [activeTab, setActiveTab] = useState<CampaignTypes>();\n  const [campaignToDelete, setCampaignToDelete] = useState<CampaignData | undefined>();\n  const [campaignToPreview, setCampaignToPreview] = useState<CampaignData | undefined>();\n\n  async function handleFilterCampaigns({ page, query }: { page: number; query?: CampaignTypes }) {\n    try {\n      const { data } = await filterCampaigns({ page, query });\n      return data;\n    } catch (error) {}\n  }\n\n  function handleSearchCampaigns(query: string) {\n    setSearchQuery(query);\n  }\n\n  function handleCampaignStateChange(campaign: CampaignData, state: CampaignData['state']) {\n    mutateCampaignState({ campaign, state });\n  }\n\n  function handleCampaignDelete() {\n    if (campaignToDelete) {\n      mutateDeleteCampaign(campaignToDelete);\n    }\n  }\n\n  function handlePagination(pageNumber: number) {\n    if (pageNumber > page) {\n      setStart(start + CAMPAIGN_LIST_LIMIT);\n      setEnd(end + CAMPAIGN_LIST_LIMIT);\n    } else {\n      setStart(start - CAMPAIGN_LIST_LIMIT);\n      setEnd(end - CAMPAIGN_LIST_LIMIT);\n    }\n    setPage(pageNumber);\n  }\n\n  function handleTabChange(tab: CampaignTypes) {\n    setActiveTab(tab);\n    setPage(1);\n    setStart(1);\n    setEnd(CAMPAIGN_LIST_LIMIT);\n  }\n\n  function handleEditCampaign(campaign: CampaignData) {\n    history.push(`/s/marketing/campaigns/${campaign.id}`);\n  }\n\n  function handleCreateOneTimeCampaign() {\n    history.push('/s/marketing/campaigns/new/one-time-campaign');\n  }\n\n  function handleABTestCampaign() {\n    history.push('/s/marketing/campaigns/new/ab-test-campaign');\n  }\n\n  function handleViewCampaignStats(campaign: CampaignData) {\n    sendAmplitudeData('viewCampaignStats');\n    history.push(`/s/marketing/campaigns/${campaign.id}/analytics`);\n  }\n\n  function getTableActions(data: CampaignData) {\n    const tableActionsStart = [\n      {\n        icon: 'play',\n        label: 'Start campaign',\n        onClick: (data: CampaignData) => handleCampaignStateChange(data, 'started'),\n      },\n      {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: (data: CampaignData) => setCampaignToPreview(data),\n      },\n      {\n        icon: 'edit',\n        label: 'Edit campaign',\n        onClick: (data: CampaignData) => handleEditCampaign(data),\n      },\n      {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: (data: CampaignData) => setCampaignToDelete(data),\n      },\n    ] as TableDropdownAction<CampaignData>[];\n\n    const tableActionsPause = [\n      {\n        icon: 'pause',\n        label: 'Pause campaign',\n        onClick: (data: CampaignData) => {\n          const state = data.state === 'started' ? 'paused' : 'started';\n          handleCampaignStateChange(data, state);\n        },\n      },\n      {\n        icon: 'stop',\n        label: 'Stop campaign',\n        onClick: (data: CampaignData) => handleCampaignStateChange(data, 'stopped'),\n      },\n      {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: (data: CampaignData) => {\n          sendAmplitudeData('previewCampaign', { data });\n          setCampaignToPreview(data);\n        },\n      },\n      {\n        icon: 'view',\n        label: 'View stats',\n        onClick: (data: CampaignData) => handleViewCampaignStats(data),\n      },\n      {\n        icon: 'edit',\n        label: 'Edit campaign',\n        onClick: (data: CampaignData) => handleEditCampaign(data),\n      },\n      {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: (data: CampaignData) => setCampaignToDelete(data),\n      },\n    ] as TableDropdownAction<CampaignData>[];\n\n    if (data.state === 'pristine') {\n      return tableActionsStart;\n    }\n\n    if (data.state === 'paused') {\n      return [\n        {\n          icon: 'play',\n          label: 'Start campaign',\n          onClick: (data: CampaignData) => handleCampaignStateChange(data, 'started'),\n        },\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'view',\n          label: 'View stats',\n          onClick: (data: CampaignData) => handleViewCampaignStats(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    if (data.state === 'stopped') {\n      return [\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'view',\n          label: 'View stats',\n          onClick: (data: CampaignData) => handleViewCampaignStats(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    if (data.state === 'draft') {\n      return [\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'edit',\n          label: 'Edit campaign',\n          onClick: (data: CampaignData) => handleEditCampaign(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    if (data.state === 'started' && !!data.schedule_start) {\n      return [\n        {\n          icon: 'pause',\n          label: 'Pause campaign',\n          onClick: (data: CampaignData) => {\n            const state = data.state === 'started' ? 'paused' : 'started';\n            handleCampaignStateChange(data, state);\n          },\n        },\n        {\n          icon: 'stop',\n          label: 'Stop campaign',\n          onClick: (data: CampaignData) => handleCampaignStateChange(data, 'stopped'),\n        },\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'view',\n          label: 'View stats',\n          onClick: (data: CampaignData) => handleViewCampaignStats(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    if (data.state === 'completed' || (data.state && data.schedule_start === null)) {\n      return [\n        {\n          icon: 'view',\n          label: 'View stats',\n          onClick: (data: CampaignData) => handleViewCampaignStats(data),\n        },\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    return tableActionsPause;\n  }\n\n  const { data, isLoading: isFetchingCampaigns } = useQuery(\n    ['campaigns', page, activeTab],\n    () => handleFilterCampaigns({ page, query: activeTab }),\n    { keepPreviousData: true },\n  );\n\n  const { data: searchResults, isLoading: isSearchingCampaigns } = useQuery(\n    ['campaigns', searchQuery],\n    () => searchCampaigns({ query: searchQuery || undefined, state: activeTab }),\n    { enabled: !!searchQuery },\n  );\n\n  const { mutate: mutateCampaignState } = useMutation<any, AxiosError, any, any>(\n    (payload: { campaign: CampaignData; state: CampaignData['state'] }) =>\n      saveCampaignItemState({ id: payload.campaign.id, state: payload.state }),\n    {\n      onMutate: async payload => {\n        const { campaign, state } = payload;\n        const { id } = campaign;\n        const newData = { ...campaign, state };\n        await queryClient.cancelQueries(['campaigns', page, activeTab]);\n        const previousCampaigns = queryClient.getQueryData(['campaigns', page, activeTab]);\n        queryClient.setQueryData(['campaigns', page, activeTab], old => ({\n          //@ts-ignore\n          ...old,\n          //@ts-ignore\n          campaigns: old?.campaigns.map(campaign => {\n            if (campaign.id === id) {\n              return newData;\n            }\n            return campaign;\n          }),\n        }));\n        return { previousCampaigns };\n      },\n      onSuccess: newData => {\n        queryClient.invalidateQueries(['campaigns', page, activeTab]);\n        sendAmplitudeData('campaignStateChanged', { state: newData.state });\n      },\n      onError: (error, _, context) => {\n        queryClient.setQueryData(['campaigns', page, activeTab], context.previousCampaigns);\n        toast({\n          position: 'bottom-left',\n          render: ({ onClose }) => <ToastBox onClose={onClose} message={error.message} />,\n        });\n      },\n    },\n  );\n\n  const { isLoading: isDeleting, mutate: mutateDeleteCampaign } = useMutation<\n    any,\n    AxiosError,\n    any,\n    any\n  >((campaign: CampaignData) => deleteCampaignItem({ id: campaign.id }), {\n    onMutate: async payload => {\n      const { id } = payload;\n      await queryClient.cancelQueries(['campaigns', page, activeTab]);\n      const previousCampaigns = queryClient.getQueryData(['campaigns', page, activeTab]);\n      queryClient.setQueryData(['campaigns', page, activeTab], old => ({\n        //@ts-ignore\n        ...old,\n        //@ts-ignore\n        campaigns: old?.campaigns.filter(campaign => campaign.id !== id),\n      }));\n      return { previousCampaigns };\n    },\n    onSuccess: newData => {\n      queryClient.invalidateQueries(['campaigns', page, activeTab]);\n      setCampaignToDelete(undefined);\n      sendAmplitudeData('campaignDeleted');\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => (\n          <ToastBox status=\"success\" onClose={onClose} message=\"Campaign deleted successfully\" />\n        ),\n      });\n    },\n    onError: (error, _, context) => {\n      queryClient.setQueryData(['campaigns', page, activeTab], context.previousCampaigns);\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => <ToastBox onClose={onClose} message={error.message} />,\n      });\n    },\n  });\n\n  return (\n    <>\n      <Flex pb=\"2.5rem\" alignItems=\"center\" justifyContent=\"space-between\">\n        <Box>\n          <Heading as=\"h4\" pb=\"0.2rem\" fontSize=\"1.2rem\" fontWeight={600} color=\"black\">\n            Campaigns\n          </Heading>\n          <Text maxW=\"500px\" color=\"#4f4f4f\" fontSize=\"0.875rem\">\n            Easily design and send targeted messages to reach your customers throughout their\n            lifecycle.\n          </Text>\n        </Box>\n        <Button size=\"sm\" variantColor=\"blue\" onClick={onOpenCreateCampaignModal}>\n          Create campaign\n        </Button>\n      </Flex>\n      <CampaignContent\n        end={end}\n        page={page}\n        start={start}\n        selectedTab={activeTab}\n        onTabChange={handleTabChange}\n        onPagination={handlePagination}\n        onSearch={handleSearchCampaigns}\n        getTableActions={getTableActions}\n        total_count={data?.meta?.count_total}\n        stateOptions={[\n          { label: 'All', value: undefined },\n          { label: 'Scheduled', value: 'scheduled' },\n          { label: 'Sent', value: 'sent' },\n          { label: 'Draft', value: 'draft' },\n        ]}\n        campaignsList={searchResults ?? data?.campaigns}\n        isLoading={isFetchingCampaigns || isSearchingCampaigns}\n      />\n      <ConfirmModal\n        title=\"Delete campaign\"\n        isLoading={isDeleting}\n        isOpen={!!campaignToDelete}\n        onConfirm={handleCampaignDelete}\n        onClose={() => setCampaignToDelete(undefined)}\n      />\n      <CampaingPreviewModal\n        campaign={campaignToPreview}\n        isOpen={!!campaignToPreview}\n        onClose={() => setCampaignToPreview(undefined)}\n      />\n      <CampaignMetaModal\n        title=\"Create a campaign\"\n        isOpen={isCreateCampaignModalOpen}\n        onClose={onCloseCreateCampaignModal}\n        options={[\n          {\n            icon: 'single-campaign',\n            title: 'One-time message',\n            caption:\n              'Keep subscribers engaged and drive revenue by sharing your latest news or promoting a product or sale.',\n            onSelect: handleCreateOneTimeCampaign,\n            showButton: false,\n          },\n          {\n            icon: 'multi-campaign',\n            title: 'A/B test',\n            caption:\n              'Send up to four variants of a single message, testing text or images to determine which perform best.',\n            onSelect: handleABTestCampaign,\n            showButton: false,\n          },\n        ]}\n      />\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}