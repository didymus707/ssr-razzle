{"ast":null,"code":"import _objectSpread from \"/Users/public1/Documents/Projects/ssr-razzle/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/public1/Documents/Projects/ssr-razzle/src/app/authenticated-app/marketing/coupons/index.tsx\";\nvar __jsx = React.createElement;\nimport { Box, Flex, Heading, Text, useToast } from '@chakra-ui/core';\nimport { Button, ConfirmModal, ToastBox } from 'app/components';\nimport React from 'react';\nimport { useMutation, useQuery, useQueryClient } from 'react-query';\nimport { useHistory } from 'react-router';\nimport { sendAmplitudeData } from 'utils/amplitude';\nimport { CampaignContent, CAMPAIGN_LIST_LIMIT, CampaingPreviewModal, deleteCampaignItem, filterCoupons, saveCampaignItemState, searchCoupons } from '../campaigns';\nexport const MarketingCoupons = () => {\n  var _data$meta;\n\n  const toast = useToast();\n  const history = useHistory();\n  const queryClient = useQueryClient();\n  const [page, setPage] = React.useState(1);\n  const [start, setStart] = React.useState(1);\n  const [searchQuery, setSearchQuery] = React.useState('');\n  const [end, setEnd] = React.useState(CAMPAIGN_LIST_LIMIT);\n  const [activeTab, setActiveTab] = React.useState();\n  const [campaignToDelete, setCampaignToDelete] = React.useState();\n  const [campaignToPreview, setCampaignToPreview] = React.useState();\n\n  async function handleFilterCampaigns({\n    page,\n    query\n  }) {\n    try {\n      const {\n        data\n      } = await filterCoupons({\n        page,\n        query\n      });\n      return data;\n    } catch (error) {}\n  }\n\n  function handleSearchCampaigns(query) {\n    setSearchQuery(query);\n  }\n\n  function handleCreateCouponClick() {\n    history.push('/s/marketing/coupons/new/');\n  }\n\n  function handleCampaignStateChange(campaign, state) {\n    mutateCampaignState({\n      campaign,\n      state\n    });\n  }\n\n  function handleCampaignDelete() {\n    if (campaignToDelete) {\n      mutateDeleteCampaign(campaignToDelete);\n    }\n  }\n\n  function handleTabChange(tab) {\n    setActiveTab(tab);\n    setPage(1);\n    setStart(1);\n    setEnd(CAMPAIGN_LIST_LIMIT);\n  }\n\n  function handlePagination(pageNumber) {\n    if (pageNumber > page) {\n      setStart(start + CAMPAIGN_LIST_LIMIT);\n      setEnd(end + CAMPAIGN_LIST_LIMIT);\n    } else {\n      setStart(start - CAMPAIGN_LIST_LIMIT);\n      setEnd(end - CAMPAIGN_LIST_LIMIT);\n    }\n\n    setPage(pageNumber);\n  }\n\n  function handleEditCampaign(coupon) {\n    history.push(`/s/marketing/coupons/${coupon.id}`);\n  }\n\n  function handleViewCampaignStats(coupon) {\n    sendAmplitudeData('viewCampaignStats');\n    history.push(`/s/marketing/campaigns/${coupon.id}/analytics`);\n  }\n\n  function getTableActions(data) {\n    const tableActionsStart = [{\n      icon: 'play',\n      label: 'Start campaign',\n      onClick: data => handleCampaignStateChange(data, 'started')\n    }, {\n      icon: 'info',\n      label: 'Preview campaign',\n      onClick: data => setCampaignToPreview(data)\n    }, {\n      icon: 'edit',\n      label: 'Edit campaign',\n      onClick: data => handleEditCampaign(data)\n    }, {\n      icon: 'delete',\n      label: 'Delete campaign',\n      onClick: data => setCampaignToDelete(data)\n    }];\n    const tableActionsPause = [{\n      icon: 'pause',\n      label: 'Pause campaign',\n      onClick: data => {\n        const state = data.state === 'started' ? 'paused' : 'started';\n        handleCampaignStateChange(data, state);\n      }\n    }, {\n      icon: 'stop',\n      label: 'Stop campaign',\n      onClick: data => handleCampaignStateChange(data, 'stopped')\n    }, {\n      icon: 'info',\n      label: 'Preview campaign',\n      onClick: data => {\n        sendAmplitudeData('previewCampaign', {\n          data\n        });\n        setCampaignToPreview(data);\n      }\n    }, {\n      icon: 'view',\n      label: 'View stats',\n      onClick: data => handleViewCampaignStats(data)\n    }, {\n      icon: 'edit',\n      label: 'Edit campaign',\n      onClick: data => handleEditCampaign(data)\n    }, {\n      icon: 'delete',\n      label: 'Delete campaign',\n      onClick: data => setCampaignToDelete(data)\n    }];\n\n    if (data.state === 'pristine') {\n      return tableActionsStart;\n    }\n\n    if (data.state === 'paused') {\n      return [{\n        icon: 'play',\n        label: 'Start campaign',\n        onClick: data => handleCampaignStateChange(data, 'started')\n      }, {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'view',\n        label: 'View stats',\n        onClick: data => handleViewCampaignStats(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    if (data.state === 'stopped') {\n      return [{\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'view',\n        label: 'View stats',\n        onClick: data => handleViewCampaignStats(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    if (data.state === 'draft') {\n      return [{\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'edit',\n        label: 'Edit campaign',\n        onClick: data => handleEditCampaign(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    if (data.state === 'started' && !!data.schedule_start) {\n      return [{\n        icon: 'pause',\n        label: 'Pause campaign',\n        onClick: data => {\n          const state = data.state === 'started' ? 'paused' : 'started';\n          handleCampaignStateChange(data, state);\n        }\n      }, {\n        icon: 'stop',\n        label: 'Stop campaign',\n        onClick: data => handleCampaignStateChange(data, 'stopped')\n      }, {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'view',\n        label: 'View stats',\n        onClick: data => handleViewCampaignStats(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    if (data.state === 'completed' || data.state && data.schedule_start === null) {\n      return [{\n        icon: 'view',\n        label: 'View stats',\n        onClick: data => handleViewCampaignStats(data)\n      }, {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: data => setCampaignToPreview(data)\n      }, {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: data => setCampaignToDelete(data)\n      }];\n    }\n\n    return tableActionsPause;\n  }\n\n  const {\n    data,\n    isLoading: isFetchingCoupons\n  } = useQuery(['coupons', page, activeTab], () => handleFilterCampaigns({\n    page,\n    query: activeTab\n  }), {\n    keepPreviousData: true\n  });\n  const {\n    data: searchResults,\n    isLoading: isSearchingCampaigns\n  } = useQuery(['coupons', searchQuery], () => searchCoupons({\n    query: searchQuery || undefined,\n    state: activeTab\n  }), {\n    enabled: !!searchQuery\n  });\n  const {\n    mutate: mutateCampaignState\n  } = useMutation(payload => saveCampaignItemState({\n    id: payload.campaign.id,\n    state: payload.state\n  }), {\n    onMutate: async payload => {\n      const {\n        campaign,\n        state\n      } = payload;\n      const {\n        id\n      } = campaign;\n\n      const newData = _objectSpread(_objectSpread({}, campaign), {}, {\n        state\n      });\n\n      await queryClient.cancelQueries(['coupons', page, activeTab]);\n      const previousCampaigns = queryClient.getQueryData(['coupons', page, activeTab]);\n      queryClient.setQueryData(['coupons', page, activeTab], old => _objectSpread(_objectSpread({}, old), {}, {\n        //@ts-ignore\n        campaigns: old === null || old === void 0 ? void 0 : old.campaigns.map(campaign => {\n          if (campaign.id === id) {\n            return newData;\n          }\n\n          return campaign;\n        })\n      }));\n      return {\n        previousCampaigns\n      };\n    },\n    onSuccess: newData => {\n      queryClient.invalidateQueries(['coupons', page, activeTab]);\n      sendAmplitudeData('campaignStateChanged', {\n        state: newData.state\n      });\n    },\n    onError: (error, _, context) => {\n      queryClient.setQueryData(['coupons', page, activeTab], context.previousCampaigns);\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error.message,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 36\n          }\n        })\n      });\n    }\n  });\n  const {\n    isLoading: isDeleting,\n    mutate: mutateDeleteCampaign\n  } = useMutation(campaign => deleteCampaignItem({\n    id: campaign.id\n  }), {\n    onMutate: async payload => {\n      const {\n        id\n      } = payload;\n      await queryClient.cancelQueries(['coupons', page, activeTab]);\n      const previousCampaigns = queryClient.getQueryData(['coupons', page, activeTab]);\n      queryClient.setQueryData(['coupons', page, activeTab], old => _objectSpread(_objectSpread({}, old), {}, {\n        //@ts-ignore\n        campaigns: old === null || old === void 0 ? void 0 : old.campaigns.filter(campaign => campaign.id !== id)\n      }));\n      return {\n        previousCampaigns\n      };\n    },\n    onSuccess: newData => {\n      queryClient.invalidateQueries(['coupons', page, activeTab]);\n      setCampaignToDelete(undefined);\n      sendAmplitudeData('campaignDeleted');\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          status: \"success\",\n          onClose: onClose,\n          message: \"Campaign deleted successfully\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 11\n          }\n        })\n      });\n    },\n    onError: (error, _, context) => {\n      queryClient.setQueryData(['coupons', page, activeTab], context.previousCampaigns);\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error.message,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 34\n          }\n        })\n      });\n    }\n  });\n  return __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 5\n    }\n  }, __jsx(Flex, {\n    pb: \"2.5rem\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 7\n    }\n  }, __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 9\n    }\n  }, __jsx(Heading, {\n    as: \"h4\",\n    pb: \"0.2rem\",\n    fontSize: \"1.2rem\",\n    fontWeight: 600,\n    color: \"black\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 11\n    }\n  }, \"Coupons\"), __jsx(Text, {\n    maxW: \"500px\",\n    color: \"#4f4f4f\",\n    fontSize: \"0.875rem\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 11\n    }\n  }, \"Add or edit coupon sets.\")), __jsx(Button, {\n    size: \"sm\",\n    variantColor: \"blue\",\n    onClick: handleCreateCouponClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 9\n    }\n  }, \"Create coupon set\")), __jsx(CampaignContent, {\n    end: end,\n    page: page,\n    start: start,\n    selectedTab: activeTab,\n    searchQuery: searchQuery,\n    onTabChange: handleTabChange,\n    onPagination: handlePagination,\n    onSearch: handleSearchCampaigns,\n    getTableActions: getTableActions,\n    total_count: data === null || data === void 0 ? void 0 : (_data$meta = data.meta) === null || _data$meta === void 0 ? void 0 : _data$meta.count_total,\n    stateOptions: [{\n      label: 'All',\n      value: undefined\n    }, {\n      label: 'Scheduled',\n      value: 'scheduled'\n    }, {\n      label: 'Sent',\n      value: 'sent'\n    }],\n    campaignsList: searchResults !== null && searchResults !== void 0 ? searchResults : data === null || data === void 0 ? void 0 : data.campaigns,\n    isLoading: isFetchingCoupons || isSearchingCampaigns,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 374,\n      columnNumber: 7\n    }\n  }), __jsx(ConfirmModal, {\n    title: \"Delete coupon\",\n    isLoading: isDeleting,\n    isOpen: !!campaignToDelete,\n    onConfirm: handleCampaignDelete,\n    onClose: () => setCampaignToDelete(undefined),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 7\n    }\n  }), __jsx(CampaingPreviewModal, {\n    campaign: campaignToPreview,\n    isOpen: !!campaignToPreview,\n    onClose: () => setCampaignToPreview(undefined),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 400,\n      columnNumber: 7\n    }\n  }));\n};","map":{"version":3,"sources":["/Users/public1/Documents/Projects/ssr-razzle/src/app/authenticated-app/marketing/coupons/index.tsx"],"names":["Box","Flex","Heading","Text","useToast","Button","ConfirmModal","ToastBox","React","useMutation","useQuery","useQueryClient","useHistory","sendAmplitudeData","CampaignContent","CAMPAIGN_LIST_LIMIT","CampaingPreviewModal","deleteCampaignItem","filterCoupons","saveCampaignItemState","searchCoupons","MarketingCoupons","toast","history","queryClient","page","setPage","useState","start","setStart","searchQuery","setSearchQuery","end","setEnd","activeTab","setActiveTab","campaignToDelete","setCampaignToDelete","campaignToPreview","setCampaignToPreview","handleFilterCampaigns","query","data","error","handleSearchCampaigns","handleCreateCouponClick","push","handleCampaignStateChange","campaign","state","mutateCampaignState","handleCampaignDelete","mutateDeleteCampaign","handleTabChange","tab","handlePagination","pageNumber","handleEditCampaign","coupon","id","handleViewCampaignStats","getTableActions","tableActionsStart","icon","label","onClick","tableActionsPause","schedule_start","isLoading","isFetchingCoupons","keepPreviousData","searchResults","isSearchingCampaigns","undefined","enabled","mutate","payload","onMutate","newData","cancelQueries","previousCampaigns","getQueryData","setQueryData","old","campaigns","map","onSuccess","invalidateQueries","onError","_","context","position","render","onClose","message","isDeleting","filter","meta","count_total","value"],"mappings":"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","sourcesContent":["import { Box, Flex, Heading, Text, useToast } from '@chakra-ui/core';\nimport { Button, ConfirmModal, TableDropdownAction, ToastBox } from 'app/components';\nimport { AxiosError } from 'axios';\nimport React from 'react';\nimport { useMutation, useQuery, useQueryClient } from 'react-query';\nimport { useHistory } from 'react-router';\nimport { sendAmplitudeData } from 'utils/amplitude';\nimport {\n  CampaignContent,\n  CAMPAIGN_LIST_LIMIT,\n  CampaingPreviewModal,\n  deleteCampaignItem,\n  filterCoupons,\n  saveCampaignItemState,\n  searchCoupons,\n} from '../campaigns';\nimport { CampaignData, CampaignTypes } from '../campaigns/campaigns.types';\n\nexport const MarketingCoupons = () => {\n  const toast = useToast();\n  const history = useHistory();\n  const queryClient = useQueryClient();\n\n  const [page, setPage] = React.useState(1);\n  const [start, setStart] = React.useState(1);\n  const [searchQuery, setSearchQuery] = React.useState('');\n  const [end, setEnd] = React.useState(CAMPAIGN_LIST_LIMIT);\n  const [activeTab, setActiveTab] = React.useState<CampaignTypes>();\n  const [campaignToDelete, setCampaignToDelete] = React.useState<CampaignData | undefined>();\n  const [campaignToPreview, setCampaignToPreview] = React.useState<CampaignData | undefined>();\n\n  async function handleFilterCampaigns({ page, query }: { page: number; query?: CampaignTypes }) {\n    try {\n      const { data } = await filterCoupons({ page, query });\n      return data;\n    } catch (error) {}\n  }\n\n  function handleSearchCampaigns(query: string) {\n    setSearchQuery(query);\n  }\n\n  function handleCreateCouponClick() {\n    history.push('/s/marketing/coupons/new/');\n  }\n\n  function handleCampaignStateChange(campaign: CampaignData, state: CampaignData['state']) {\n    mutateCampaignState({ campaign, state });\n  }\n\n  function handleCampaignDelete() {\n    if (campaignToDelete) {\n      mutateDeleteCampaign(campaignToDelete);\n    }\n  }\n\n  function handleTabChange(tab: CampaignTypes) {\n    setActiveTab(tab);\n    setPage(1);\n    setStart(1);\n    setEnd(CAMPAIGN_LIST_LIMIT);\n  }\n\n  function handlePagination(pageNumber: number) {\n    if (pageNumber > page) {\n      setStart(start + CAMPAIGN_LIST_LIMIT);\n      setEnd(end + CAMPAIGN_LIST_LIMIT);\n    } else {\n      setStart(start - CAMPAIGN_LIST_LIMIT);\n      setEnd(end - CAMPAIGN_LIST_LIMIT);\n    }\n    setPage(pageNumber);\n  }\n\n  function handleEditCampaign(coupon: CampaignData) {\n    history.push(`/s/marketing/coupons/${coupon.id}`);\n  }\n\n  function handleViewCampaignStats(coupon: CampaignData) {\n    sendAmplitudeData('viewCampaignStats');\n    history.push(`/s/marketing/campaigns/${coupon.id}/analytics`);\n  }\n\n  function getTableActions(data: CampaignData) {\n    const tableActionsStart = [\n      {\n        icon: 'play',\n        label: 'Start campaign',\n        onClick: (data: CampaignData) => handleCampaignStateChange(data, 'started'),\n      },\n      {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: (data: CampaignData) => setCampaignToPreview(data),\n      },\n      {\n        icon: 'edit',\n        label: 'Edit campaign',\n        onClick: (data: CampaignData) => handleEditCampaign(data),\n      },\n      {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: (data: CampaignData) => setCampaignToDelete(data),\n      },\n    ] as TableDropdownAction<CampaignData>[];\n\n    const tableActionsPause = [\n      {\n        icon: 'pause',\n        label: 'Pause campaign',\n        onClick: (data: CampaignData) => {\n          const state = data.state === 'started' ? 'paused' : 'started';\n          handleCampaignStateChange(data, state);\n        },\n      },\n      {\n        icon: 'stop',\n        label: 'Stop campaign',\n        onClick: (data: CampaignData) => handleCampaignStateChange(data, 'stopped'),\n      },\n      {\n        icon: 'info',\n        label: 'Preview campaign',\n        onClick: (data: CampaignData) => {\n          sendAmplitudeData('previewCampaign', { data });\n          setCampaignToPreview(data);\n        },\n      },\n      {\n        icon: 'view',\n        label: 'View stats',\n        onClick: (data: CampaignData) => handleViewCampaignStats(data),\n      },\n      {\n        icon: 'edit',\n        label: 'Edit campaign',\n        onClick: (data: CampaignData) => handleEditCampaign(data),\n      },\n      {\n        icon: 'delete',\n        label: 'Delete campaign',\n        onClick: (data: CampaignData) => setCampaignToDelete(data),\n      },\n    ] as TableDropdownAction<CampaignData>[];\n\n    if (data.state === 'pristine') {\n      return tableActionsStart;\n    }\n\n    if (data.state === 'paused') {\n      return [\n        {\n          icon: 'play',\n          label: 'Start campaign',\n          onClick: (data: CampaignData) => handleCampaignStateChange(data, 'started'),\n        },\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'view',\n          label: 'View stats',\n          onClick: (data: CampaignData) => handleViewCampaignStats(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    if (data.state === 'stopped') {\n      return [\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'view',\n          label: 'View stats',\n          onClick: (data: CampaignData) => handleViewCampaignStats(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    if (data.state === 'draft') {\n      return [\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'edit',\n          label: 'Edit campaign',\n          onClick: (data: CampaignData) => handleEditCampaign(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    if (data.state === 'started' && !!data.schedule_start) {\n      return [\n        {\n          icon: 'pause',\n          label: 'Pause campaign',\n          onClick: (data: CampaignData) => {\n            const state = data.state === 'started' ? 'paused' : 'started';\n            handleCampaignStateChange(data, state);\n          },\n        },\n        {\n          icon: 'stop',\n          label: 'Stop campaign',\n          onClick: (data: CampaignData) => handleCampaignStateChange(data, 'stopped'),\n        },\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'view',\n          label: 'View stats',\n          onClick: (data: CampaignData) => handleViewCampaignStats(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    if (data.state === 'completed' || (data.state && data.schedule_start === null)) {\n      return [\n        {\n          icon: 'view',\n          label: 'View stats',\n          onClick: (data: CampaignData) => handleViewCampaignStats(data),\n        },\n        {\n          icon: 'info',\n          label: 'Preview campaign',\n          onClick: (data: CampaignData) => setCampaignToPreview(data),\n        },\n        {\n          icon: 'delete',\n          label: 'Delete campaign',\n          onClick: (data: CampaignData) => setCampaignToDelete(data),\n        },\n      ];\n    }\n\n    return tableActionsPause;\n  }\n\n  const { data, isLoading: isFetchingCoupons } = useQuery(\n    ['coupons', page, activeTab],\n    () => handleFilterCampaigns({ page, query: activeTab }),\n    { keepPreviousData: true },\n  );\n\n  const { data: searchResults, isLoading: isSearchingCampaigns } = useQuery(\n    ['coupons', searchQuery],\n    () => searchCoupons({ query: searchQuery || undefined, state: activeTab }),\n    { enabled: !!searchQuery },\n  );\n\n  const { mutate: mutateCampaignState } = useMutation<any, AxiosError, any, any>(\n    (payload: { campaign: CampaignData; state: CampaignData['state'] }) =>\n      saveCampaignItemState({ id: payload.campaign.id, state: payload.state }),\n    {\n      onMutate: async payload => {\n        const { campaign, state } = payload;\n        const { id } = campaign;\n        const newData = { ...campaign, state };\n        await queryClient.cancelQueries(['coupons', page, activeTab]);\n        const previousCampaigns = queryClient.getQueryData(['coupons', page, activeTab]);\n        queryClient.setQueryData(['coupons', page, activeTab], old => ({\n          //@ts-ignore\n          ...old,\n          //@ts-ignore\n          campaigns: old?.campaigns.map(campaign => {\n            if (campaign.id === id) {\n              return newData;\n            }\n            return campaign;\n          }),\n        }));\n        return { previousCampaigns };\n      },\n      onSuccess: newData => {\n        queryClient.invalidateQueries(['coupons', page, activeTab]);\n        sendAmplitudeData('campaignStateChanged', { state: newData.state });\n      },\n      onError: (error, _, context) => {\n        queryClient.setQueryData(['coupons', page, activeTab], context.previousCampaigns);\n        toast({\n          position: 'bottom-left',\n          render: ({ onClose }) => <ToastBox onClose={onClose} message={error.message} />,\n        });\n      },\n    },\n  );\n\n  const { isLoading: isDeleting, mutate: mutateDeleteCampaign } = useMutation<\n    any,\n    AxiosError,\n    any,\n    any\n  >((campaign: CampaignData) => deleteCampaignItem({ id: campaign.id }), {\n    onMutate: async payload => {\n      const { id } = payload;\n      await queryClient.cancelQueries(['coupons', page, activeTab]);\n      const previousCampaigns = queryClient.getQueryData(['coupons', page, activeTab]);\n      queryClient.setQueryData(['coupons', page, activeTab], old => ({\n        //@ts-ignore\n        ...old,\n        //@ts-ignore\n        campaigns: old?.campaigns.filter(campaign => campaign.id !== id),\n      }));\n      return { previousCampaigns };\n    },\n    onSuccess: newData => {\n      queryClient.invalidateQueries(['coupons', page, activeTab]);\n      setCampaignToDelete(undefined);\n      sendAmplitudeData('campaignDeleted');\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => (\n          <ToastBox status=\"success\" onClose={onClose} message=\"Campaign deleted successfully\" />\n        ),\n      });\n    },\n    onError: (error, _, context) => {\n      queryClient.setQueryData(['coupons', page, activeTab], context.previousCampaigns);\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => <ToastBox onClose={onClose} message={error.message} />,\n      });\n    },\n  });\n\n  return (\n    <Box>\n      <Flex pb=\"2.5rem\" alignItems=\"center\" justifyContent=\"space-between\">\n        <Box>\n          <Heading as=\"h4\" pb=\"0.2rem\" fontSize=\"1.2rem\" fontWeight={600} color=\"black\">\n            Coupons\n          </Heading>\n          <Text maxW=\"500px\" color=\"#4f4f4f\" fontSize=\"0.875rem\">\n            Add or edit coupon sets.\n          </Text>\n        </Box>\n        <Button size=\"sm\" variantColor=\"blue\" onClick={handleCreateCouponClick}>\n          Create coupon set\n        </Button>\n      </Flex>\n      <CampaignContent\n        end={end}\n        page={page}\n        start={start}\n        selectedTab={activeTab}\n        searchQuery={searchQuery}\n        onTabChange={handleTabChange}\n        onPagination={handlePagination}\n        onSearch={handleSearchCampaigns}\n        getTableActions={getTableActions}\n        total_count={data?.meta?.count_total}\n        stateOptions={[\n          { label: 'All', value: undefined },\n          { label: 'Scheduled', value: 'scheduled' },\n          { label: 'Sent', value: 'sent' },\n        ]}\n        campaignsList={searchResults ?? data?.campaigns}\n        isLoading={isFetchingCoupons || isSearchingCampaigns}\n      />\n      <ConfirmModal\n        title=\"Delete coupon\"\n        isLoading={isDeleting}\n        isOpen={!!campaignToDelete}\n        onConfirm={handleCampaignDelete}\n        onClose={() => setCampaignToDelete(undefined)}\n      />\n      <CampaingPreviewModal\n        campaign={campaignToPreview}\n        isOpen={!!campaignToPreview}\n        onClose={() => setCampaignToPreview(undefined)}\n      />\n    </Box>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}