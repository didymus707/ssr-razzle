{"ast":null,"code":"const _excluded = [\"id\"];\nvar _jsxFileName = \"/Users/okechukwuiheagwara/Documents/Adewale/simpu/razzle/with-typescript/src/app/authenticated-app/marketing/templates/templates.ui.tsx\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { Box, Flex, Heading, useDisclosure, useToast } from '@chakra-ui/core';\nimport { Button, ConfirmModal, SmallText, ToastBox } from 'app/components';\nimport * as React from 'react';\nimport { useLoading } from '../../../../hooks';\nimport { sendAmplitudeData } from '../../../../utils/amplitude';\nimport { TemplateModal } from './components';\nimport { TemplateContent } from './components/template-content';\nimport { html2Text } from './templates.utils';\nexport function TemplatesComponent(props) {\n  const {\n    lists,\n    templates,\n    addTemplate,\n    lists_by_id,\n    editTemplate,\n    removeTemplate,\n    fetchTemplates,\n    sampleTemplates,\n    templateCategories,\n    fetchSampleTemplates,\n    templatesSearchResults\n  } = props;\n  const mappedTemplateCategories = templateCategories.map(item => item.category);\n  const {\n    isOpen,\n    onClose,\n    onOpen\n  } = useDisclosure();\n  const [activeTab, setActiveTab] = React.useState('my-templates');\n  const [templateToEdit, setTemplateToEdit] = React.useState();\n  const [templateToDelete, setTemplateToDelete] = React.useState();\n  const [selectedCategory, setSelectedCategory] = React.useState(mappedTemplateCategories[0]);\n  const [templateToDuplicate, setTemplateToDuplicate] = React.useState();\n  const tableActions = [{\n    icon: 'copy',\n    label: 'Duplicate template',\n    onClick: data => setTemplateToDuplicate(data)\n  }, {\n    icon: 'delete',\n    label: 'Delete template',\n    onClick: data => setTemplateToDelete(data)\n  }];\n  const listOptions = lists_by_id //@ts-ignore\n  .map(id => lists[id]).map(({\n    name,\n    id\n  }) => ({\n    label: name,\n    value: id\n  }));\n  const toast = useToast();\n  const {\n    dispatch,\n    loading,\n    globalLoading\n  } = useLoading();\n\n  async function handleFetchCategoryTemplates(category) {\n    try {\n      setSelectedCategory(category);\n      dispatch({\n        type: 'LOADING_STARTED'\n      });\n      await fetchSampleTemplates({\n        category\n      });\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n    } catch (error) {\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 64,\n            columnNumber: 34\n          }\n        })\n      });\n    }\n  }\n\n  async function handleSearchTemplates(query) {\n    if (query) {\n      try {\n        dispatch({\n          type: 'GLOBAL_LOADING_STARTED'\n        });\n        await templatesSearchResults(query);\n        dispatch({\n          type: 'GLOBAL_LOADING_RESOLVED'\n        });\n      } catch (error) {\n        dispatch({\n          type: 'GLOBAL_LOADING_RESOLVED'\n        });\n        toast({\n          position: 'bottom-left',\n          render: ({\n            onClose\n          }) => __jsx(ToastBox, {\n            onClose: onClose,\n            message: error,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 79,\n              columnNumber: 36\n            }\n          })\n        });\n      }\n    } else {\n      try {\n        dispatch({\n          type: 'GLOBAL_LOADING_STARTED'\n        });\n        await fetchTemplates();\n        dispatch({\n          type: 'GLOBAL_LOADING_RESOLVED'\n        });\n      } catch (error) {\n        dispatch({\n          type: 'GLOBAL_LOADING_RESOLVED'\n        });\n        toast({\n          position: 'bottom-left',\n          render: ({\n            onClose\n          }) => __jsx(ToastBox, {\n            onClose: onClose,\n            message: error,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 91,\n              columnNumber: 36\n            }\n          })\n        });\n      }\n    }\n  }\n\n  async function handleAddTemplate(template) {\n    try {\n      dispatch({\n        type: 'LOADING_STARTED'\n      });\n      await addTemplate(template);\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      onClose();\n      sendAmplitudeData('templateAdded');\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          status: \"success\",\n          message: \"Template created\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 107,\n            columnNumber: 11\n          }\n        })\n      });\n    } catch (error) {\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 34\n          }\n        })\n      });\n    }\n  }\n\n  async function handleDuplicateTemplate() {\n    if (templateToDuplicate) {\n      const {\n        id\n      } = templateToDuplicate,\n            rest = _objectWithoutProperties(templateToDuplicate, _excluded);\n\n      try {\n        dispatch({\n          type: 'LOADING_STARTED'\n        });\n        await addTemplate(rest);\n        dispatch({\n          type: 'LOADING_RESOLVED'\n        });\n        setTemplateToDuplicate(undefined);\n        sendAmplitudeData('templateDuplicated');\n        toast({\n          position: 'bottom-left',\n          render: ({\n            onClose\n          }) => __jsx(ToastBox, {\n            onClose: onClose,\n            status: \"success\",\n            message: \"Template duplicated\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 131,\n              columnNumber: 13\n            }\n          })\n        });\n      } catch (error) {\n        dispatch({\n          type: 'LOADING_RESOLVED'\n        });\n        toast({\n          position: 'bottom-left',\n          render: ({\n            onClose\n          }) => __jsx(ToastBox, {\n            onClose: onClose,\n            message: error,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 138,\n              columnNumber: 36\n            }\n          })\n        });\n      }\n    }\n  }\n\n  async function handleUpdateTemplate(payload) {\n    try {\n      dispatch({\n        type: 'LOADING_STARTED'\n      });\n      await editTemplate(_objectSpread(_objectSpread({}, payload), {}, {\n        template: html2Text(payload.template)\n      }));\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      setTemplateToEdit(undefined);\n      sendAmplitudeData('templateUpdated');\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          status: \"success\",\n          message: \"Template edited\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 11\n          }\n        })\n      });\n    } catch (error) {\n      dispatch({\n        type: 'LOADING_RESOLVED'\n      });\n      toast({\n        position: 'bottom-left',\n        render: ({\n          onClose\n        }) => __jsx(ToastBox, {\n          onClose: onClose,\n          message: error,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 34\n          }\n        })\n      });\n    }\n  }\n\n  async function handleDeleteTemplate() {\n    if (templateToDelete) {\n      try {\n        dispatch({\n          type: 'LOADING_STARTED'\n        });\n        await removeTemplate(templateToDelete.id);\n        dispatch({\n          type: 'LOADING_RESOLVED'\n        });\n        setTemplateToDelete(undefined);\n        sendAmplitudeData('templateDeleted');\n        toast({\n          position: 'bottom-left',\n          render: ({\n            onClose\n          }) => __jsx(ToastBox, {\n            onClose: onClose,\n            status: \"success\",\n            message: \"Template deleted\",\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 13\n            }\n          })\n        });\n      } catch (error) {\n        dispatch({\n          type: 'LOADING_RESOLVED'\n        });\n        toast({\n          position: 'bottom-left',\n          render: ({\n            onClose\n          }) => __jsx(ToastBox, {\n            onClose: onClose,\n            message: error,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 36\n            }\n          })\n        });\n      }\n    }\n  }\n\n  function handleTabChange(tab) {\n    setActiveTab(tab);\n  }\n\n  React.useEffect(() => {\n    handleFetchCategoryTemplates(mappedTemplateCategories[0]); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return __jsx(React.Fragment, null, __jsx(Flex, {\n    pb: \"2.5rem\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 7\n    }\n  }, __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 9\n    }\n  }, __jsx(Heading, {\n    as: \"h4\",\n    pb: \"0.2rem\",\n    fontSize: \"1.2rem\",\n    fontWeight: 600,\n    color: \"black\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 11\n    }\n  }, \"Templates\"), __jsx(SmallText, {\n    maxW: \"500px\",\n    color: \"#4f4f4f\",\n    fontSize: \"0.875rem\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 11\n    }\n  }, \"Easily design templated messages for your campaigns to reach your customers.\")), __jsx(Button, {\n    size: \"sm\",\n    variantColor: \"blue\",\n    onClick: onOpen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  }, \"Create template\")), __jsx(TemplateContent, {\n    templates: templates,\n    selectedTab: activeTab,\n    lists_by_id: lists_by_id,\n    tableActions: tableActions,\n    onTabChange: handleTabChange,\n    onSearch: handleSearchTemplates,\n    sampleTemplates: sampleTemplates,\n    selectedCategory: selectedCategory,\n    categories: mappedTemplateCategories,\n    isLoading: globalLoading === 'pending',\n    handleCategoryClick: handleFetchCategoryTemplates,\n    stateOptions: [{\n      label: 'My Templates',\n      value: 'my-templates'\n    }, {\n      label: 'Sample Templates',\n      value: 'sample-templates'\n    }],\n    onTemplateItemClick: data => setTemplateToEdit(data),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }\n  }), __jsx(TemplateModal, {\n    lists: lists,\n    isOpen: isOpen,\n    onClose: onClose,\n    title: \"Add template\",\n    listOptions: listOptions,\n    lists_by_id: lists_by_id,\n    onSubmit: handleAddTemplate,\n    isLoading: loading === 'pending',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 232,\n      columnNumber: 7\n    }\n  }), __jsx(TemplateModal, {\n    lists: lists,\n    title: \"Edit template\",\n    listOptions: listOptions,\n    isOpen: !!templateToEdit,\n    lists_by_id: lists_by_id,\n    initialValues: templateToEdit,\n    onSubmit: handleUpdateTemplate,\n    isLoading: loading === 'pending',\n    onClose: () => setTemplateToEdit(undefined),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 7\n    }\n  }), __jsx(ConfirmModal, {\n    title: \"Duplicate template\",\n    isOpen: !!templateToDuplicate,\n    isLoading: loading === 'pending',\n    onConfirm: handleDuplicateTemplate,\n    onClose: () => setTemplateToDuplicate(undefined),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 253,\n      columnNumber: 7\n    }\n  }), __jsx(ConfirmModal, {\n    title: \"Delete template\",\n    isOpen: !!templateToDelete,\n    onConfirm: handleDeleteTemplate,\n    isLoading: loading === 'pending',\n    onClose: () => setTemplateToDelete(undefined),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 7\n    }\n  }));\n}","map":{"version":3,"sources":["/Users/okechukwuiheagwara/Documents/Adewale/simpu/razzle/with-typescript/src/app/authenticated-app/marketing/templates/templates.ui.tsx"],"names":["Box","Flex","Heading","useDisclosure","useToast","Button","ConfirmModal","SmallText","ToastBox","React","useLoading","sendAmplitudeData","TemplateModal","TemplateContent","html2Text","TemplatesComponent","props","lists","templates","addTemplate","lists_by_id","editTemplate","removeTemplate","fetchTemplates","sampleTemplates","templateCategories","fetchSampleTemplates","templatesSearchResults","mappedTemplateCategories","map","item","category","isOpen","onClose","onOpen","activeTab","setActiveTab","useState","templateToEdit","setTemplateToEdit","templateToDelete","setTemplateToDelete","selectedCategory","setSelectedCategory","templateToDuplicate","setTemplateToDuplicate","tableActions","icon","label","onClick","data","listOptions","id","name","value","toast","dispatch","loading","globalLoading","handleFetchCategoryTemplates","type","error","position","render","handleSearchTemplates","query","handleAddTemplate","template","handleDuplicateTemplate","rest","undefined","handleUpdateTemplate","payload","handleDeleteTemplate","handleTabChange","tab","useEffect"],"mappings":"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","sourcesContent":["import { Box, Flex, Heading, useDisclosure, useToast } from '@chakra-ui/core';\nimport { Button, ConfirmModal, SmallText, TableDropdownAction, ToastBox } from 'app/components';\nimport * as React from 'react';\nimport { useLoading } from '../../../../hooks';\nimport { sendAmplitudeData } from '../../../../utils/amplitude';\nimport { TemplateFormValues, TemplateModal } from './components';\nimport { TemplateContent } from './components/template-content';\nimport { TemplateData, TemplatesContainerProps } from './templates.types';\nimport { html2Text } from './templates.utils';\n\nexport function TemplatesComponent(props: TemplatesContainerProps) {\n  const {\n    lists,\n    templates,\n    addTemplate,\n    lists_by_id,\n    editTemplate,\n    removeTemplate,\n    fetchTemplates,\n    sampleTemplates,\n    templateCategories,\n    fetchSampleTemplates,\n    templatesSearchResults,\n  } = props;\n  const mappedTemplateCategories = templateCategories.map(item => item.category);\n\n  const { isOpen, onClose, onOpen } = useDisclosure();\n  const [activeTab, setActiveTab] = React.useState('my-templates');\n  const [templateToEdit, setTemplateToEdit] = React.useState<TemplateData | undefined>();\n  const [templateToDelete, setTemplateToDelete] = React.useState<TemplateData | undefined>();\n  const [selectedCategory, setSelectedCategory] = React.useState(mappedTemplateCategories[0]);\n  const [templateToDuplicate, setTemplateToDuplicate] = React.useState<TemplateData | undefined>();\n  const tableActions = [\n    {\n      icon: 'copy',\n      label: 'Duplicate template',\n      onClick: (data: TemplateData) => setTemplateToDuplicate(data),\n    },\n    {\n      icon: 'delete',\n      label: 'Delete template',\n      onClick: (data: TemplateData) => setTemplateToDelete(data),\n    },\n  ] as TableDropdownAction<TemplateData>[];\n\n  const listOptions = lists_by_id\n    //@ts-ignore\n    .map((id: string) => lists[id])\n    .map(({ name, id }: { name: string; id: string }) => ({ label: name, value: id }));\n\n  const toast = useToast();\n  const { dispatch, loading, globalLoading } = useLoading();\n\n  async function handleFetchCategoryTemplates(category: string) {\n    try {\n      setSelectedCategory(category);\n      dispatch({ type: 'LOADING_STARTED' });\n      await fetchSampleTemplates({ category });\n      dispatch({ type: 'LOADING_RESOLVED' });\n    } catch (error) {\n      dispatch({ type: 'LOADING_RESOLVED' });\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n      });\n    }\n  }\n\n  async function handleSearchTemplates(query: string) {\n    if (query) {\n      try {\n        dispatch({ type: 'GLOBAL_LOADING_STARTED' });\n        await templatesSearchResults(query);\n        dispatch({ type: 'GLOBAL_LOADING_RESOLVED' });\n      } catch (error) {\n        dispatch({ type: 'GLOBAL_LOADING_RESOLVED' });\n        toast({\n          position: 'bottom-left',\n          render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n        });\n      }\n    } else {\n      try {\n        dispatch({ type: 'GLOBAL_LOADING_STARTED' });\n        await fetchTemplates();\n        dispatch({ type: 'GLOBAL_LOADING_RESOLVED' });\n      } catch (error) {\n        dispatch({ type: 'GLOBAL_LOADING_RESOLVED' });\n        toast({\n          position: 'bottom-left',\n          render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n        });\n      }\n    }\n  }\n\n  async function handleAddTemplate(template: TemplateFormValues) {\n    try {\n      dispatch({ type: 'LOADING_STARTED' });\n      await addTemplate(template);\n      dispatch({ type: 'LOADING_RESOLVED' });\n      onClose();\n      sendAmplitudeData('templateAdded');\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => (\n          <ToastBox onClose={onClose} status=\"success\" message=\"Template created\" />\n        ),\n      });\n    } catch (error) {\n      dispatch({ type: 'LOADING_RESOLVED' });\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n      });\n    }\n  }\n\n  async function handleDuplicateTemplate() {\n    if (templateToDuplicate) {\n      const { id, ...rest } = templateToDuplicate;\n      try {\n        dispatch({ type: 'LOADING_STARTED' });\n        await addTemplate(rest);\n        dispatch({ type: 'LOADING_RESOLVED' });\n        setTemplateToDuplicate(undefined);\n        sendAmplitudeData('templateDuplicated');\n        toast({\n          position: 'bottom-left',\n          render: ({ onClose }) => (\n            <ToastBox onClose={onClose} status=\"success\" message=\"Template duplicated\" />\n          ),\n        });\n      } catch (error) {\n        dispatch({ type: 'LOADING_RESOLVED' });\n        toast({\n          position: 'bottom-left',\n          render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n        });\n      }\n    }\n  }\n\n  async function handleUpdateTemplate(payload: TemplateFormValues) {\n    try {\n      dispatch({ type: 'LOADING_STARTED' });\n      await editTemplate({ ...payload, template: html2Text(payload.template) });\n      dispatch({ type: 'LOADING_RESOLVED' });\n      setTemplateToEdit(undefined);\n      sendAmplitudeData('templateUpdated');\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => (\n          <ToastBox onClose={onClose} status=\"success\" message=\"Template edited\" />\n        ),\n      });\n    } catch (error) {\n      dispatch({ type: 'LOADING_RESOLVED' });\n      toast({\n        position: 'bottom-left',\n        render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n      });\n    }\n  }\n\n  async function handleDeleteTemplate() {\n    if (templateToDelete) {\n      try {\n        dispatch({ type: 'LOADING_STARTED' });\n        await removeTemplate(templateToDelete.id);\n        dispatch({ type: 'LOADING_RESOLVED' });\n        setTemplateToDelete(undefined);\n        sendAmplitudeData('templateDeleted');\n        toast({\n          position: 'bottom-left',\n          render: ({ onClose }) => (\n            <ToastBox onClose={onClose} status=\"success\" message=\"Template deleted\" />\n          ),\n        });\n      } catch (error) {\n        dispatch({ type: 'LOADING_RESOLVED' });\n        toast({\n          position: 'bottom-left',\n          render: ({ onClose }) => <ToastBox onClose={onClose} message={error} />,\n        });\n      }\n    }\n  }\n\n  function handleTabChange(tab: string) {\n    setActiveTab(tab);\n  }\n\n  React.useEffect(() => {\n    handleFetchCategoryTemplates(mappedTemplateCategories[0]);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <>\n      <Flex pb=\"2.5rem\" alignItems=\"center\" justifyContent=\"space-between\">\n        <Box>\n          <Heading as=\"h4\" pb=\"0.2rem\" fontSize=\"1.2rem\" fontWeight={600} color=\"black\">\n            Templates\n          </Heading>\n          <SmallText maxW=\"500px\" color=\"#4f4f4f\" fontSize=\"0.875rem\">\n            Easily design templated messages for your campaigns to reach your customers.\n          </SmallText>\n        </Box>\n        <Button size=\"sm\" variantColor=\"blue\" onClick={onOpen}>\n          Create template\n        </Button>\n      </Flex>\n      <TemplateContent\n        templates={templates}\n        selectedTab={activeTab}\n        lists_by_id={lists_by_id}\n        tableActions={tableActions}\n        onTabChange={handleTabChange}\n        onSearch={handleSearchTemplates}\n        sampleTemplates={sampleTemplates}\n        selectedCategory={selectedCategory}\n        categories={mappedTemplateCategories}\n        isLoading={globalLoading === 'pending'}\n        handleCategoryClick={handleFetchCategoryTemplates}\n        stateOptions={[\n          { label: 'My Templates', value: 'my-templates' },\n          { label: 'Sample Templates', value: 'sample-templates' },\n        ]}\n        onTemplateItemClick={(data: TemplateData) => setTemplateToEdit(data)}\n      />\n      <TemplateModal\n        lists={lists}\n        isOpen={isOpen}\n        onClose={onClose}\n        title=\"Add template\"\n        listOptions={listOptions}\n        lists_by_id={lists_by_id}\n        onSubmit={handleAddTemplate}\n        isLoading={loading === 'pending'}\n      />\n      <TemplateModal\n        lists={lists}\n        title=\"Edit template\"\n        listOptions={listOptions}\n        isOpen={!!templateToEdit}\n        lists_by_id={lists_by_id}\n        initialValues={templateToEdit}\n        onSubmit={handleUpdateTemplate}\n        isLoading={loading === 'pending'}\n        onClose={() => setTemplateToEdit(undefined)}\n      />\n      <ConfirmModal\n        title=\"Duplicate template\"\n        isOpen={!!templateToDuplicate}\n        isLoading={loading === 'pending'}\n        onConfirm={handleDuplicateTemplate}\n        onClose={() => setTemplateToDuplicate(undefined)}\n      />\n      <ConfirmModal\n        title=\"Delete template\"\n        isOpen={!!templateToDelete}\n        onConfirm={handleDeleteTemplate}\n        isLoading={loading === 'pending'}\n        onClose={() => setTemplateToDelete(undefined)}\n      />\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}