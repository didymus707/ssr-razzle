{"ast":null,"code":"var _jsxFileName = \"/Users/public1/Documents/Projects/ssr-razzle/src/app/authenticated-app/inbox/components/messages/compose/EmailMessageCompose.tsx\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Box, Flex, Icon, Stack } from '@chakra-ui/core';\nimport { html2Text } from 'app/authenticated-app/marketing/templates/templates.utils';\nimport { Button, Input, Menu, MenuItem, SmallText } from 'app/components';\nimport { ContentState, convertFromHTML, convertToRaw, EditorState, Modifier, RichUtils } from 'draft-js';\nimport 'draft-js/dist/Draft.css';\nimport draftToHtml from 'draftjs-to-html';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useInbox } from '../../Provider';\nimport { Attachments } from './Attachments';\nimport { BlockStyleControls, DraftEditor, DraftEditorContainer, InlineStyleControls } from './DraftEditor';\nimport { Emoji } from './Emoji';\nimport { FilePicker } from './FilePicker';\nimport { Request } from './Request';\nimport { Template } from './Template';\nexport const EmailMessageCompose = props => {\n  const {\n    thread,\n    channel,\n    onSubmit,\n    sender_id,\n    sendAndClose,\n    requestProps,\n    twoWayPayload,\n    initialValues,\n    onCloseCompose\n  } = props;\n  const {\n    to: toProp,\n    cc: ccProp,\n    bcc: bccProp,\n    text: textProp,\n    from: fromProp,\n    subject: subjectProp\n  } = initialValues !== null && initialValues !== void 0 ? initialValues : {};\n  const {\n    0: showCC,\n    1: setShowCC\n  } = useState(false);\n  const {\n    0: showBCC,\n    1: setShowBCC\n  } = useState(false);\n  const {\n    0: attachedFiles,\n    1: setAttachedFiles\n  } = useState([]);\n  const {\n    0: from,\n    1: setFrom\n  } = useState(fromProp || '');\n  const {\n    0: to,\n    1: setTo\n  } = useState(toProp || '');\n  const {\n    0: cc,\n    1: setCC\n  } = useState(ccProp || '');\n  const {\n    0: editorState,\n    1: setEditorState\n  } = useState(EditorState.createEmpty());\n  const {\n    0: bcc,\n    1: setBCC\n  } = useState(bccProp || '');\n  const {\n    0: subject,\n    1: setSubject\n  } = useState(subjectProp || '');\n  const editorRef = useRef(null);\n  const {\n    isNewConversation\n  } = useInbox();\n\n  const handleFromChange = e => {\n    setFrom(e.target.value);\n  };\n\n  const handleToChange = e => {\n    setTo(e.target.value);\n  };\n\n  const handleCCChange = e => {\n    setCC(e.target.value);\n  };\n\n  const handleBCCChange = e => {\n    setBCC(e.target.value);\n  };\n\n  const handleSubjectChange = e => {\n    setSubject(e.target.value);\n  };\n\n  const toggleBlockType = blockType => {\n    setEditorState(RichUtils.toggleBlockType(editorState, blockType));\n  };\n\n  const toggleInlineStyle = inlineStyle => {\n    setEditorState(RichUtils.toggleInlineStyle(editorState, inlineStyle));\n  };\n\n  const handleTemplateChange = (text, isTemplateMode, subject) => {\n    const blocksFromHTML = convertFromHTML(text);\n    const contentState = ContentState.createFromBlockArray(blocksFromHTML.contentBlocks, blocksFromHTML.entityMap);\n    setSubject(subject);\n    setEditorState(EditorState.moveFocusToEnd(EditorState.createWithContent(contentState)));\n  };\n\n  const handleEmojiClick = (event, emojiObject) => {\n    const currentContent = editorState.getCurrentContent(),\n          currentSelection = editorState.getSelection();\n    const newContent = Modifier.replaceText(currentContent, currentSelection, emojiObject.emoji);\n    const newEditorState = EditorState.push(editorState, newContent, 'insert-characters');\n    setEditorState(EditorState.forceSelection(newEditorState, newContent.getSelectionAfter()));\n  };\n\n  const handleClearState = () => {\n    onCloseCompose === null || onCloseCompose === void 0 ? void 0 : onCloseCompose();\n    setCC('');\n    setBCC('');\n    setSubject('');\n    setShowCC(false);\n    setShowBCC(false);\n    setAttachedFiles([]);\n    setEditorState(EditorState.createEmpty());\n  };\n\n  const handleSubmit = () => {\n    const rawContentState = convertToRaw(editorState.getCurrentContent());\n    const text = rawContentState && draftToHtml(rawContentState, {\n      trigger: '#',\n      separator: ' '\n    });\n    let payload = {\n      to,\n      from,\n      subject,\n      type: 'message',\n      body_html: text,\n      content_type: 'html',\n      files: attachedFiles,\n      body: html2Text(text),\n      thread_id: thread.uuid,\n      cc: JSON.stringify(cc === null || cc === void 0 ? void 0 : cc.split(',')),\n      bcc: JSON.stringify(bcc === null || bcc === void 0 ? void 0 : bcc.split(','))\n    };\n\n    if (isNewConversation) {\n      const {\n        contact_id,\n        contactName,\n        senderPlatformNick,\n        credential_id\n      } = twoWayPayload !== null && twoWayPayload !== void 0 ? twoWayPayload : {};\n      payload = _objectSpread(_objectSpread({}, payload), {}, {\n        contact_id,\n        credential_id,\n        contact_name: contactName,\n        user_nick: senderPlatformNick\n      });\n    }\n\n    onSubmit === null || onSubmit === void 0 ? void 0 : onSubmit(payload);\n    handleClearState();\n  };\n\n  const handleSendAndClose = () => {\n    const rawContentState = convertToRaw(editorState.getCurrentContent());\n    const text = rawContentState && draftToHtml(rawContentState, {\n      trigger: '#',\n      separator: ' '\n    });\n    let payload = {\n      to,\n      from,\n      subject,\n      type: 'message',\n      body_html: text,\n      content_type: 'html',\n      files: attachedFiles,\n      body: html2Text(text),\n      thread_id: thread.uuid,\n      cc: JSON.stringify(cc === null || cc === void 0 ? void 0 : cc.split(',')),\n      bcc: JSON.stringify(bcc === null || bcc === void 0 ? void 0 : bcc.split(','))\n    };\n\n    if (isNewConversation) {\n      const {\n        contact_id,\n        contactName,\n        senderPlatformNick,\n        credential_id\n      } = twoWayPayload !== null && twoWayPayload !== void 0 ? twoWayPayload : {};\n      payload = _objectSpread(_objectSpread({}, payload), {}, {\n        contact_id,\n        credential_id,\n        contact_name: contactName,\n        user_nick: senderPlatformNick\n      });\n    }\n\n    sendAndClose === null || sendAndClose === void 0 ? void 0 : sendAndClose(payload);\n    handleClearState();\n  };\n\n  useEffect(() => {\n    if (editorRef.current) {\n      editorRef.current.focus();\n    }\n  }, []);\n  useEffect(() => {\n    setTo(toProp);\n  }, [toProp]);\n  useEffect(() => {\n    setFrom(fromProp);\n  }, [fromProp]);\n  useEffect(() => {\n    setCC(ccProp);\n  }, [ccProp]);\n  useEffect(() => {\n    setBCC(bccProp);\n  }, [bccProp]);\n  useEffect(() => {\n    setSubject(subjectProp);\n  }, [subjectProp]);\n  useEffect(() => {\n    handleTemplateChange(textProp !== null && textProp !== void 0 ? textProp : '', undefined, subjectProp);\n  }, [textProp, subjectProp]);\n  return __jsx(Box, {\n    py: \"1rem\",\n    borderRadius: \"8px\",\n    paddingLeft: \"1.25rem\",\n    paddingRight: \"1.5625rem\",\n    border: \"1px solid rgb(228, 233, 240)\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 5\n    }\n  }, __jsx(Flex, {\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }\n  }, __jsx(Stack, {\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 9\n    }\n  }, __jsx(Stack, {\n    spacing: \"0.25rem\",\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 11\n    }\n  }, __jsx(SmallText, {\n    color: \"gray.400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 13\n    }\n  }, \"From:\"), __jsx(Input, {\n    size: \"sm\",\n    minW: \"100px\",\n    value: from,\n    borderWidth: \"0\",\n    _hover: {\n      borderWidth: '0'\n    },\n    _focus: {\n      borderWidth: '0'\n    },\n    _active: {\n      borderWidth: '0'\n    },\n    onChange: handleFromChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 13\n    }\n  })), __jsx(Stack, {\n    spacing: \"0.25rem\",\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 286,\n      columnNumber: 11\n    }\n  }, __jsx(SmallText, {\n    color: \"gray.400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 13\n    }\n  }, \"To:\"), __jsx(Input, {\n    size: \"sm\",\n    value: to,\n    minW: \"100px\",\n    borderWidth: \"0\",\n    _hover: {\n      borderWidth: '0'\n    },\n    _focus: {\n      borderWidth: '0'\n    },\n    _active: {\n      borderWidth: '0'\n    },\n    onChange: handleToChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 288,\n      columnNumber: 13\n    }\n  }))), __jsx(Stack, {\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 9\n    }\n  }, !(showCC || cc) && __jsx(Button, {\n    size: \"xs\",\n    variant: \"ghost\",\n    color: \"gray.500\",\n    fontWeight: \"normal\",\n    fontSize: \"0.875rem\",\n    onClick: () => setShowCC(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 13\n    }\n  }, \"CC\"), !(showBCC || bcc) && __jsx(Button, {\n    size: \"xs\",\n    variant: \"ghost\",\n    color: \"gray.500\",\n    fontWeight: \"normal\",\n    fontSize: \"0.875rem\",\n    onClick: () => setShowBCC(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 13\n    }\n  }, \"BCC\"))), __jsx(Stack, {\n    spacing: \"0.25rem\",\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 327,\n      columnNumber: 7\n    }\n  }, __jsx(SmallText, {\n    color: \"gray.400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 9\n    }\n  }, \"Subject:\"), __jsx(Input, {\n    size: \"sm\",\n    value: subject,\n    minW: \"100px\",\n    borderWidth: \"0\",\n    _hover: {\n      borderWidth: '0'\n    },\n    _focus: {\n      borderWidth: '0'\n    },\n    _active: {\n      borderWidth: '0'\n    },\n    onChange: handleSubjectChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 9\n    }\n  })), __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 7\n    }\n  }, (showCC || cc) && __jsx(Stack, {\n    width: \"100%\",\n    spacing: \"0.25rem\",\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 342,\n      columnNumber: 11\n    }\n  }, __jsx(SmallText, {\n    color: \"gray.400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 343,\n      columnNumber: 13\n    }\n  }, \"CC:\"), __jsx(Input, {\n    size: \"sm\",\n    value: cc,\n    borderWidth: \"0\",\n    _hover: {\n      borderWidth: '0'\n    },\n    _focus: {\n      borderWidth: '0'\n    },\n    _active: {\n      borderWidth: '0'\n    },\n    onChange: handleCCChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 13\n    }\n  })), (showBCC || bcc) && __jsx(Stack, {\n    width: \"100%\",\n    spacing: \"0.25rem\",\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 11\n    }\n  }, __jsx(SmallText, {\n    color: \"gray.400\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 13\n    }\n  }, \"BCC:\"), __jsx(Input, {\n    size: \"sm\",\n    value: bcc,\n    borderWidth: \"0\",\n    _hover: {\n      borderWidth: '0'\n    },\n    _focus: {\n      borderWidth: '0'\n    },\n    _active: {\n      borderWidth: '0'\n    },\n    onChange: handleBCCChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 13\n    }\n  }))), __jsx(Attachments, {\n    files: attachedFiles,\n    setFiles: setAttachedFiles,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 7\n    }\n  }), __jsx(DraftEditorContainer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 7\n    }\n  }, __jsx(Box, {\n    height: \"150px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 372,\n      columnNumber: 9\n    }\n  }, __jsx(DraftEditor, {\n    ref: editorRef,\n    editorState: editorState,\n    onChange: setEditorState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 11\n    }\n  })), __jsx(Flex, {\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 9\n    }\n  }, __jsx(Stack, {\n    spacing: \"1rem\",\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 376,\n      columnNumber: 11\n    }\n  }, __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 13\n    }\n  }, __jsx(InlineStyleControls, {\n    editorState: editorState,\n    onToggle: toggleInlineStyle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 378,\n      columnNumber: 15\n    }\n  })), __jsx(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 380,\n      columnNumber: 13\n    }\n  }, __jsx(BlockStyleControls, {\n    editorState: editorState,\n    onToggle: toggleBlockType,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 15\n    }\n  }))), __jsx(Flex, {\n    justifyContent: \"flex-end\",\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 11\n    }\n  }, __jsx(Stack, {\n    spacing: \"1rem\",\n    isInline: true,\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 13\n    }\n  }, __jsx(Template, {\n    setText: handleTemplateChange,\n    sender_id: sender_id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 15\n    }\n  }), __jsx(Emoji, {\n    onEmojiClick: handleEmojiClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 15\n    }\n  }), __jsx(Request, _extends({}, requestProps, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 15\n    }\n  })), __jsx(FilePicker, {\n    channel: channel,\n    files: attachedFiles,\n    setFiles: setAttachedFiles,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 15\n    }\n  }), __jsx(Button, {\n    size: \"xs\",\n    variant: \"ghost\",\n    onClick: handleClearState,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 15\n    }\n  }, __jsx(Icon, {\n    name: \"inbox-compose-trash\",\n    size: \"16px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 17\n    }\n  }))), __jsx(Flex, {\n    pl: \"0.5rem\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    size: \"sm\",\n    roundedRight: \"0\",\n    variantColor: \"blue\",\n    onClick: handleSubmit,\n    roundedTopLeft: \"100px\",\n    roundedBottomLeft: \"100px\" //@ts-ignore\n    ,\n    leftIcon: \"inbox-compose-send\",\n    isDisabled: !editorState.getCurrentContent().hasText() || attachedFiles.length > 0,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 395,\n      columnNumber: 15\n    }\n  }, \"Send\"), __jsx(Menu, {\n    renderItem: option => __jsx(MenuItem, _extends({\n      key: Date.now().toString()\n    }, option, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 39\n      }\n    })),\n    menuButtonProps: {\n      as: Button,\n      size: 'sm',\n      roundedLeft: '0',\n      //@ts-ignore\n      variantColor: 'blue',\n      roundedTopRight: '100px',\n      roundedBottomRight: '100px',\n      _focus: {\n        boxShadow: 'none'\n      },\n      children: __jsx(Icon, {\n        name: \"chevron-down\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 29\n        }\n      }),\n      isDisabled: !editorState.getCurrentContent().hasText() || attachedFiles.length > 0\n    },\n    options: [{\n      children: 'Send and close',\n      onClick: handleSendAndClose\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 15\n    }\n  }))))));\n};","map":{"version":3,"sources":["/Users/public1/Documents/Projects/ssr-razzle/src/app/authenticated-app/inbox/components/messages/compose/EmailMessageCompose.tsx"],"names":["Box","Flex","Icon","Stack","html2Text","Button","Input","Menu","MenuItem","SmallText","ContentState","convertFromHTML","convertToRaw","EditorState","Modifier","RichUtils","draftToHtml","React","useEffect","useRef","useState","useInbox","Attachments","BlockStyleControls","DraftEditor","DraftEditorContainer","InlineStyleControls","Emoji","FilePicker","Request","Template","EmailMessageCompose","props","thread","channel","onSubmit","sender_id","sendAndClose","requestProps","twoWayPayload","initialValues","onCloseCompose","to","toProp","cc","ccProp","bcc","bccProp","text","textProp","from","fromProp","subject","subjectProp","showCC","setShowCC","showBCC","setShowBCC","attachedFiles","setAttachedFiles","setFrom","setTo","setCC","editorState","setEditorState","createEmpty","setBCC","setSubject","editorRef","isNewConversation","handleFromChange","e","target","value","handleToChange","handleCCChange","handleBCCChange","handleSubjectChange","toggleBlockType","blockType","toggleInlineStyle","inlineStyle","handleTemplateChange","isTemplateMode","blocksFromHTML","contentState","createFromBlockArray","contentBlocks","entityMap","moveFocusToEnd","createWithContent","handleEmojiClick","event","emojiObject","currentContent","getCurrentContent","currentSelection","getSelection","newContent","replaceText","emoji","newEditorState","push","forceSelection","getSelectionAfter","handleClearState","handleSubmit","rawContentState","trigger","separator","payload","type","body_html","content_type","files","body","thread_id","uuid","JSON","stringify","split","contact_id","contactName","senderPlatformNick","credential_id","contact_name","user_nick","handleSendAndClose","current","focus","undefined","borderWidth","hasText","length","option","Date","now","toString","as","size","roundedLeft","variantColor","roundedTopRight","roundedBottomRight","_focus","boxShadow","children","isDisabled","onClick"],"mappings":"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","sourcesContent":["import { Box, Flex, Icon, Stack } from '@chakra-ui/core';\nimport {\n  ComposeIconsProps,\n  ThreadSchema,\n  TwoWayPayloadSchema,\n} from 'app/authenticated-app/inbox/inbox.types';\nimport { html2Text } from 'app/authenticated-app/marketing/templates/templates.utils';\nimport { Button, Input, Menu, MenuItem, SmallText } from 'app/components';\nimport {\n  ContentState,\n  convertFromHTML,\n  convertToRaw,\n  EditorState,\n  Modifier,\n  RichUtils,\n} from 'draft-js';\nimport 'draft-js/dist/Draft.css';\nimport draftToHtml from 'draftjs-to-html';\nimport { IEmojiData } from 'emoji-picker-react';\nimport React, { ChangeEvent, useEffect, useRef, useState } from 'react';\nimport { useInbox } from '../../Provider';\nimport { Attachments } from './Attachments';\nimport {\n  BlockStyleControls,\n  DraftEditor,\n  DraftEditorContainer,\n  InlineStyleControls,\n} from './DraftEditor';\nimport { Emoji } from './Emoji';\nimport { FilePicker } from './FilePicker';\nimport { Request } from './Request';\nimport { Template } from './Template';\n\ntype EmailMessageComposeProps = {\n  channel?: string;\n  sender_id: string;\n  thread: ThreadSchema;\n  onCloseCompose?(): void;\n  twoWayPayload?: TwoWayPayloadSchema;\n  onSubmit?(payload?: any, callback?: () => void): void;\n  sendAndClose?(payload?: any, callback?: () => void): void;\n  requestProps: Pick<\n    ComposeIconsProps,\n    | 'paymentItems'\n    | 'setPaymentItems'\n    | 'isModalOpened'\n    | 'setIsModalOpened'\n    | 'paymentLinkMeta'\n    | 'setPaymentLinkMeta'\n    | 'paymentRequest'\n    | 'setPaymentRequest'\n    | 'isCreatingLink'\n    | 'onSendPaymentRequest'\n  >;\n  initialValues?: {\n    cc?: string;\n    bcc?: string;\n    from?: string;\n    text?: string;\n    subject?: string;\n    to?: string | string[];\n  };\n};\n\nexport const EmailMessageCompose = (props: EmailMessageComposeProps) => {\n  const {\n    thread,\n    channel,\n    onSubmit,\n    sender_id,\n    sendAndClose,\n    requestProps,\n    twoWayPayload,\n    initialValues,\n    onCloseCompose,\n  } = props;\n  const {\n    to: toProp,\n    cc: ccProp,\n    bcc: bccProp,\n    text: textProp,\n    from: fromProp,\n    subject: subjectProp,\n  } = initialValues ?? {};\n\n  const [showCC, setShowCC] = useState(false);\n  const [showBCC, setShowBCC] = useState(false);\n  const [attachedFiles, setAttachedFiles] = useState<File[]>([]);\n  const [from, setFrom] = useState<string | undefined>(fromProp || '');\n  const [to, setTo] = useState<string | string[] | undefined>(toProp || '');\n  const [cc, setCC] = useState<string | undefined>(ccProp || '');\n  const [editorState, setEditorState] = useState(EditorState.createEmpty());\n  const [bcc, setBCC] = useState<string | undefined>(bccProp || '');\n  const [subject, setSubject] = useState<string | undefined>(subjectProp || '');\n\n  const editorRef = useRef<any>(null);\n  const { isNewConversation } = useInbox();\n\n  const handleFromChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setFrom(e.target.value);\n  };\n\n  const handleToChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setTo(e.target.value);\n  };\n\n  const handleCCChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setCC(e.target.value);\n  };\n\n  const handleBCCChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setBCC(e.target.value);\n  };\n\n  const handleSubjectChange = (e: ChangeEvent<HTMLInputElement>) => {\n    setSubject(e.target.value);\n  };\n\n  const toggleBlockType = (blockType: string) => {\n    setEditorState(RichUtils.toggleBlockType(editorState, blockType));\n  };\n\n  const toggleInlineStyle = (inlineStyle: string) => {\n    setEditorState(RichUtils.toggleInlineStyle(editorState, inlineStyle));\n  };\n\n  const handleTemplateChange = (text: string, isTemplateMode?: boolean, subject?: string) => {\n    const blocksFromHTML = convertFromHTML(text);\n    const contentState = ContentState.createFromBlockArray(\n      blocksFromHTML.contentBlocks,\n      blocksFromHTML.entityMap,\n    );\n    setSubject(subject);\n    setEditorState(EditorState.moveFocusToEnd(EditorState.createWithContent(contentState)));\n  };\n\n  const handleEmojiClick = (event: MouseEvent, emojiObject: IEmojiData) => {\n    const currentContent = editorState.getCurrentContent(),\n      currentSelection = editorState.getSelection();\n\n    const newContent = Modifier.replaceText(currentContent, currentSelection, emojiObject.emoji);\n\n    const newEditorState = EditorState.push(editorState, newContent, 'insert-characters');\n\n    setEditorState(EditorState.forceSelection(newEditorState, newContent.getSelectionAfter()));\n  };\n\n  const handleClearState = () => {\n    onCloseCompose?.();\n    setCC('');\n    setBCC('');\n    setSubject('');\n    setShowCC(false);\n    setShowBCC(false);\n    setAttachedFiles([]);\n    setEditorState(EditorState.createEmpty());\n  };\n\n  const handleSubmit = () => {\n    const rawContentState = convertToRaw(editorState.getCurrentContent());\n    const text =\n      rawContentState &&\n      draftToHtml(rawContentState, {\n        trigger: '#',\n        separator: ' ',\n      });\n\n    let payload: any = {\n      to,\n      from,\n      subject,\n      type: 'message',\n      body_html: text,\n      content_type: 'html',\n      files: attachedFiles,\n      body: html2Text(text),\n      thread_id: thread.uuid,\n      cc: JSON.stringify(cc?.split(',')),\n      bcc: JSON.stringify(bcc?.split(',')),\n    };\n\n    if (isNewConversation) {\n      const { contact_id, contactName, senderPlatformNick, credential_id } = twoWayPayload ?? {};\n      payload = {\n        ...payload,\n        contact_id,\n        credential_id,\n        contact_name: contactName,\n        user_nick: senderPlatformNick,\n      };\n    }\n    onSubmit?.(payload);\n    handleClearState();\n  };\n\n  const handleSendAndClose = () => {\n    const rawContentState = convertToRaw(editorState.getCurrentContent());\n    const text =\n      rawContentState &&\n      draftToHtml(rawContentState, {\n        trigger: '#',\n        separator: ' ',\n      });\n\n    let payload: any = {\n      to,\n      from,\n      subject,\n      type: 'message',\n      body_html: text,\n      content_type: 'html',\n      files: attachedFiles,\n      body: html2Text(text),\n      thread_id: thread.uuid,\n      cc: JSON.stringify(cc?.split(',')),\n      bcc: JSON.stringify(bcc?.split(',')),\n    };\n\n    if (isNewConversation) {\n      const { contact_id, contactName, senderPlatformNick, credential_id } = twoWayPayload ?? {};\n      payload = {\n        ...payload,\n        contact_id,\n        credential_id,\n        contact_name: contactName,\n        user_nick: senderPlatformNick,\n      };\n    }\n    sendAndClose?.(payload);\n    handleClearState();\n  };\n\n  useEffect(() => {\n    if (editorRef.current) {\n      editorRef.current.focus();\n    }\n  }, []);\n\n  useEffect(() => {\n    setTo(toProp);\n  }, [toProp]);\n\n  useEffect(() => {\n    setFrom(fromProp);\n  }, [fromProp]);\n\n  useEffect(() => {\n    setCC(ccProp);\n  }, [ccProp]);\n\n  useEffect(() => {\n    setBCC(bccProp);\n  }, [bccProp]);\n\n  useEffect(() => {\n    setSubject(subjectProp);\n  }, [subjectProp]);\n\n  useEffect(() => {\n    handleTemplateChange(textProp ?? '', undefined, subjectProp);\n  }, [textProp, subjectProp]);\n\n  return (\n    <Box\n      py=\"1rem\"\n      borderRadius=\"8px\"\n      paddingLeft=\"1.25rem\"\n      paddingRight=\"1.5625rem\"\n      border=\"1px solid rgb(228, 233, 240)\"\n    >\n      <Flex alignItems=\"center\" justifyContent=\"space-between\">\n        <Stack isInline alignItems=\"center\">\n          <Stack spacing=\"0.25rem\" isInline alignItems=\"center\">\n            <SmallText color=\"gray.400\">From:</SmallText>\n            <Input\n              size=\"sm\"\n              minW=\"100px\"\n              value={from}\n              borderWidth=\"0\"\n              _hover={{ borderWidth: '0' }}\n              _focus={{ borderWidth: '0' }}\n              _active={{ borderWidth: '0' }}\n              onChange={handleFromChange}\n            />\n          </Stack>\n          <Stack spacing=\"0.25rem\" isInline alignItems=\"center\">\n            <SmallText color=\"gray.400\">To:</SmallText>\n            <Input\n              size=\"sm\"\n              value={to}\n              minW=\"100px\"\n              borderWidth=\"0\"\n              _hover={{ borderWidth: '0' }}\n              _focus={{ borderWidth: '0' }}\n              _active={{ borderWidth: '0' }}\n              onChange={handleToChange}\n            />\n          </Stack>\n        </Stack>\n        <Stack isInline alignItems=\"center\">\n          {!(showCC || cc) && (\n            <Button\n              size=\"xs\"\n              variant=\"ghost\"\n              color=\"gray.500\"\n              fontWeight=\"normal\"\n              fontSize=\"0.875rem\"\n              onClick={() => setShowCC(true)}\n            >\n              CC\n            </Button>\n          )}\n          {!(showBCC || bcc) && (\n            <Button\n              size=\"xs\"\n              variant=\"ghost\"\n              color=\"gray.500\"\n              fontWeight=\"normal\"\n              fontSize=\"0.875rem\"\n              onClick={() => setShowBCC(true)}\n            >\n              BCC\n            </Button>\n          )}\n        </Stack>\n      </Flex>\n      <Stack spacing=\"0.25rem\" isInline alignItems=\"center\">\n        <SmallText color=\"gray.400\">Subject:</SmallText>\n        <Input\n          size=\"sm\"\n          value={subject}\n          minW=\"100px\"\n          borderWidth=\"0\"\n          _hover={{ borderWidth: '0' }}\n          _focus={{ borderWidth: '0' }}\n          _active={{ borderWidth: '0' }}\n          onChange={handleSubjectChange}\n        />\n      </Stack>\n      <Box>\n        {(showCC || cc) && (\n          <Stack width=\"100%\" spacing=\"0.25rem\" isInline alignItems=\"center\">\n            <SmallText color=\"gray.400\">CC:</SmallText>\n            <Input\n              size=\"sm\"\n              value={cc}\n              borderWidth=\"0\"\n              _hover={{ borderWidth: '0' }}\n              _focus={{ borderWidth: '0' }}\n              _active={{ borderWidth: '0' }}\n              onChange={handleCCChange}\n            />\n          </Stack>\n        )}\n        {(showBCC || bcc) && (\n          <Stack width=\"100%\" spacing=\"0.25rem\" isInline alignItems=\"center\">\n            <SmallText color=\"gray.400\">BCC:</SmallText>\n            <Input\n              size=\"sm\"\n              value={bcc}\n              borderWidth=\"0\"\n              _hover={{ borderWidth: '0' }}\n              _focus={{ borderWidth: '0' }}\n              _active={{ borderWidth: '0' }}\n              onChange={handleBCCChange}\n            />\n          </Stack>\n        )}\n      </Box>\n      <Attachments files={attachedFiles} setFiles={setAttachedFiles} />\n      <DraftEditorContainer>\n        <Box height=\"150px\">\n          <DraftEditor ref={editorRef} editorState={editorState} onChange={setEditorState} />\n        </Box>\n        <Flex alignItems=\"center\" justifyContent=\"space-between\">\n          <Stack spacing=\"1rem\" isInline alignItems=\"center\">\n            <Box>\n              <InlineStyleControls editorState={editorState} onToggle={toggleInlineStyle} />\n            </Box>\n            <Box>\n              <BlockStyleControls editorState={editorState} onToggle={toggleBlockType} />\n            </Box>\n          </Stack>\n          <Flex justifyContent=\"flex-end\" alignItems=\"center\">\n            <Stack spacing=\"1rem\" isInline alignItems=\"center\">\n              <Template setText={handleTemplateChange} sender_id={sender_id} />\n              <Emoji onEmojiClick={handleEmojiClick} />\n              <Request {...requestProps} />\n              <FilePicker channel={channel} files={attachedFiles} setFiles={setAttachedFiles} />\n              <Button size=\"xs\" variant=\"ghost\" onClick={handleClearState}>\n                <Icon name=\"inbox-compose-trash\" size=\"16px\" />\n              </Button>\n            </Stack>\n            <Flex pl=\"0.5rem\">\n              <Button\n                size=\"sm\"\n                roundedRight=\"0\"\n                variantColor=\"blue\"\n                onClick={handleSubmit}\n                roundedTopLeft=\"100px\"\n                roundedBottomLeft=\"100px\"\n                //@ts-ignore\n                leftIcon=\"inbox-compose-send\"\n                isDisabled={!editorState.getCurrentContent().hasText() || attachedFiles.length > 0}\n              >\n                Send\n              </Button>\n              <Menu\n                renderItem={option => <MenuItem key={Date.now().toString()} {...option} />}\n                menuButtonProps={{\n                  as: Button,\n                  size: 'sm',\n                  roundedLeft: '0',\n                  //@ts-ignore\n                  variantColor: 'blue',\n                  roundedTopRight: '100px',\n                  roundedBottomRight: '100px',\n                  _focus: { boxShadow: 'none' },\n                  children: <Icon name=\"chevron-down\" />,\n                  isDisabled:\n                    !editorState.getCurrentContent().hasText() || attachedFiles.length > 0,\n                }}\n                options={[{ children: 'Send and close', onClick: handleSendAndClose }]}\n              />\n            </Flex>\n          </Flex>\n        </Flex>\n      </DraftEditorContainer>\n    </Box>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}