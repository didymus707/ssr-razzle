{"ast":null,"code":"const _excluded = [\"data\", \"method\"];\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport Axios from 'axios';\nimport { loadState } from './localstorage';\nexport const buildConversationUrl = url => `${process.env.REACT_APP_CONVERSATION_API_URL}/api/v1/${url}`;\nexport const buildPaymentURL = url => `${process.env.REACT_APP_PAYMENT_API_URL}${url}`;\nexport const buildAppsURL = url => `${process.env.REACT_APP_APPS_API_URL}${url}`;\nexport const buildGraphURL = url => `${process.env.REACT_APP_GRAPH_API_URL}${url}`;\nexport const buildMarketingReportURL = url => `${process.env.REACT_APP_MARKETING_REPORT_API_URL}${url}`;\nexport async function client(url, _ref = {}, tokenProtected = true) {\n  let {\n    data,\n    method = 'GET'\n  } = _ref,\n      customConfig = _objectWithoutProperties(_ref, _excluded);\n\n  const localData = loadState();\n  const headers = {\n    'content-type': 'application/json'\n  };\n  const token = localData && localData.token;\n  const {\n    organisations,\n    profile\n  } = localData || {\n    organisations: null,\n    profile: null\n  };\n\n  if (token && tokenProtected) {\n    headers.Authorization = token;\n  }\n\n  if (profile || organisations) {\n    // if no profile, use the organisationID of the last organization\n    headers.organisationID = profile ? profile.organisation_id : organisations[organisations.length - 1].id;\n  }\n\n  const config = _objectSpread({\n    headers,\n    method,\n    data,\n    url: `${process.env.REACT_APP_API_URL}/${url}`\n  }, customConfig);\n\n  try {\n    const result = await Axios(config);\n    const {\n      data\n    } = result;\n    return data;\n  } catch (error) {\n    throw error;\n  }\n}\nAxios.interceptors.response.use(function (response) {\n  return response;\n}, function (error) {\n  if (error.response && error.response.status === 401) {\n    window.location.href = '/login';\n  }\n\n  if (error.response && error.response.data) {\n    if (error.response.data.conversationErrorPayload) {\n      return Promise.reject(error.response.data);\n    }\n\n    return Promise.reject(error.response.data.message);\n  }\n\n  return Promise.reject(error.message);\n});","map":{"version":3,"sources":["/Users/okechukwuiheagwara/Documents/Adewale/simpu/razzle/with-typescript/src/utils/api-client.tsx"],"names":["Axios","loadState","buildConversationUrl","url","process","env","REACT_APP_CONVERSATION_API_URL","buildPaymentURL","REACT_APP_PAYMENT_API_URL","buildAppsURL","REACT_APP_APPS_API_URL","buildGraphURL","REACT_APP_GRAPH_API_URL","buildMarketingReportURL","REACT_APP_MARKETING_REPORT_API_URL","client","tokenProtected","data","method","customConfig","localData","headers","token","organisations","profile","Authorization","organisationID","organisation_id","length","id","config","REACT_APP_API_URL","result","error","interceptors","response","use","status","window","location","href","conversationErrorPayload","Promise","reject","message"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAqE,OAArE;AACA,SAASC,SAAT,QAA0B,gBAA1B;AAEA,OAAO,MAAMC,oBAAoB,GAAIC,GAAD,IACjC,GAAEC,OAAO,CAACC,GAAR,CAAYC,8BAA+B,WAAUH,GAAI,EADvD;AAGP,OAAO,MAAMI,eAAe,GAAIJ,GAAD,IAAkB,GAAEC,OAAO,CAACC,GAAR,CAAYG,yBAA0B,GAAEL,GAAI,EAAxF;AACP,OAAO,MAAMM,YAAY,GAAIN,GAAD,IAAkB,GAAEC,OAAO,CAACC,GAAR,CAAYK,sBAAuB,GAAEP,GAAI,EAAlF;AACP,OAAO,MAAMQ,aAAa,GAAIR,GAAD,IAAkB,GAAEC,OAAO,CAACC,GAAR,CAAYO,uBAAwB,GAAET,GAAI,EAApF;AACP,OAAO,MAAMU,uBAAuB,GAAIV,GAAD,IACpC,GAAEC,OAAO,CAACC,GAAR,CAAYS,kCAAmC,GAAEX,GAAI,EADnD;AAGP,OAAO,eAAeY,MAAf,CACLZ,GADK,EAEL,OAAgE,EAF3D,EAGLa,cAAc,GAAG,IAHZ,EAIL;AAAA,MAFA;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,MAAM,GAAG;AAAjB,GAEA;AAAA,MAF2BC,YAE3B;;AACA,QAAMC,SAAS,GAAGnB,SAAS,EAA3B;AACA,QAAMoB,OAAO,GAAG;AAAE,oBAAgB;AAAlB,GAAhB;AAKA,QAAMC,KAAK,GAAGF,SAAS,IAAIA,SAAS,CAACE,KAArC;AACA,QAAM;AAAEC,IAAAA,aAAF;AAAiBC,IAAAA;AAAjB,MAA6BJ,SAAS,IAAI;AAAEG,IAAAA,aAAa,EAAE,IAAjB;AAAuBC,IAAAA,OAAO,EAAE;AAAhC,GAAhD;;AACA,MAAIF,KAAK,IAAIN,cAAb,EAA6B;AAC3BK,IAAAA,OAAO,CAACI,aAAR,GAAwBH,KAAxB;AACD;;AACD,MAAIE,OAAO,IAAID,aAAf,EAA8B;AAC5B;AACAF,IAAAA,OAAO,CAACK,cAAR,GAAyBF,OAAO,GAC5BA,OAAO,CAACG,eADoB,GAE5BJ,aAAa,CAACA,aAAa,CAACK,MAAd,GAAuB,CAAxB,CAAb,CAAwCC,EAF5C;AAGD;;AACD,QAAMC,MAAM;AACVT,IAAAA,OADU;AAEVH,IAAAA,MAFU;AAGVD,IAAAA,IAHU;AAIVd,IAAAA,GAAG,EAAG,GAAEC,OAAO,CAACC,GAAR,CAAY0B,iBAAkB,IAAG5B,GAAI;AAJnC,KAKPgB,YALO,CAAZ;;AAQA,MAAI;AACF,UAAMa,MAAM,GAAG,MAAMhC,KAAK,CAAC8B,MAAD,CAA1B;AACA,UAAM;AAAEb,MAAAA;AAAF,QAAWe,MAAjB;AACA,WAAOf,IAAP;AACD,GAJD,CAIE,OAAOgB,KAAP,EAAc;AACd,UAAMA,KAAN;AACD;AACF;AAEDjC,KAAK,CAACkC,YAAN,CAAmBC,QAAnB,CAA4BC,GAA5B,CACE,UAAUD,QAAV,EAAmC;AACjC,SAAOA,QAAP;AACD,CAHH,EAIE,UAAUF,KAAV,EAA6B;AAC3B,MAAIA,KAAK,CAACE,QAAN,IAAkBF,KAAK,CAACE,QAAN,CAAeE,MAAf,KAA0B,GAAhD,EAAqD;AACnDC,IAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAuB,QAAvB;AACD;;AACD,MAAIP,KAAK,CAACE,QAAN,IAAkBF,KAAK,CAACE,QAAN,CAAelB,IAArC,EAA2C;AACzC,QAAIgB,KAAK,CAACE,QAAN,CAAelB,IAAf,CAAoBwB,wBAAxB,EAAkD;AAChD,aAAOC,OAAO,CAACC,MAAR,CAAeV,KAAK,CAACE,QAAN,CAAelB,IAA9B,CAAP;AACD;;AACD,WAAOyB,OAAO,CAACC,MAAR,CAAeV,KAAK,CAACE,QAAN,CAAelB,IAAf,CAAoB2B,OAAnC,CAAP;AACD;;AACD,SAAOF,OAAO,CAACC,MAAR,CAAeV,KAAK,CAACW,OAArB,CAAP;AACD,CAfH","sourcesContent":["import Axios, { AxiosError, AxiosRequestConfig, AxiosResponse } from 'axios';\nimport { loadState } from './localstorage';\n\nexport const buildConversationUrl = (url: string) =>\n  `${process.env.REACT_APP_CONVERSATION_API_URL}/api/v1/${url}`;\n\nexport const buildPaymentURL = (url: string) => `${process.env.REACT_APP_PAYMENT_API_URL}${url}`;\nexport const buildAppsURL = (url: string) => `${process.env.REACT_APP_APPS_API_URL}${url}`;\nexport const buildGraphURL = (url: string) => `${process.env.REACT_APP_GRAPH_API_URL}${url}`;\nexport const buildMarketingReportURL = (url: string) =>\n  `${process.env.REACT_APP_MARKETING_REPORT_API_URL}${url}`;\n\nexport async function client(\n  url: string,\n  { data, method = 'GET', ...customConfig }: AxiosRequestConfig = {},\n  tokenProtected = true,\n) {\n  const localData = loadState();\n  const headers = { 'content-type': 'application/json' } as {\n    'content-type': string;\n    Authorization: string;\n    organisationID: string;\n  };\n  const token = localData && localData.token;\n  const { organisations, profile } = localData || { organisations: null, profile: null };\n  if (token && tokenProtected) {\n    headers.Authorization = token;\n  }\n  if (profile || organisations) {\n    // if no profile, use the organisationID of the last organization\n    headers.organisationID = profile\n      ? profile.organisation_id\n      : organisations[organisations.length - 1].id;\n  }\n  const config = {\n    headers,\n    method,\n    data,\n    url: `${process.env.REACT_APP_API_URL}/${url}`,\n    ...customConfig,\n  } as AxiosRequestConfig;\n\n  try {\n    const result = await Axios(config);\n    const { data } = result;\n    return data;\n  } catch (error) {\n    throw error;\n  }\n}\n\nAxios.interceptors.response.use(\n  function (response: AxiosResponse) {\n    return response;\n  },\n  function (error: AxiosError) {\n    if (error.response && error.response.status === 401) {\n      window.location.href = '/login';\n    }\n    if (error.response && error.response.data) {\n      if (error.response.data.conversationErrorPayload) {\n        return Promise.reject(error.response.data);\n      }\n      return Promise.reject(error.response.data.message);\n    }\n    return Promise.reject(error.message);\n  },\n);\n"]},"metadata":{},"sourceType":"module"}